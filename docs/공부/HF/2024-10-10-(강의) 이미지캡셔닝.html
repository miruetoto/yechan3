<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.533">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="신록예찬">
<meta name="dcterms.date" content="2024-10-10">

<title>신록예찬’s Blog - (강의) 이미지캡셔닝</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">신록예찬’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DL2024/"> 
<span class="menu-text">DL2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/AP2023/"> 
<span class="menu-text">AP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/PP2024/"> 
<span class="menu-text">PP2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DV2023/"> 
<span class="menu-text">DV2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/MP2023/"> 
<span class="menu-text">MP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/SC2024/"> 
<span class="menu-text">SC2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DS2022/"> 
<span class="menu-text">DS2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/SP2023/"> 
<span class="menu-text">SP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/IR2021/"> 
<span class="menu-text">IR2021</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan/"> 
<span class="menu-text">yechan</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan2/"> 
<span class="menu-text">yechan2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/miruetoto/yechan3"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">(강의) 이미지캡셔닝</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../메모.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">메모</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../공부.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공부</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../연구.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">연구</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../자료.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">자료</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#image-captioning" id="toc-image-captioning" class="nav-link active" data-scroll-target="#image-captioning">Image captioning</a>
  <ul class="collapse">
  <li><a href="#load-the-pokémon-blip-captions-dataset" id="toc-load-the-pokémon-blip-captions-dataset" class="nav-link" data-scroll-target="#load-the-pokémon-blip-captions-dataset">Load the Pokémon BLIP captions dataset</a></li>
  <li><a href="#preprocess-the-dataset" id="toc-preprocess-the-dataset" class="nav-link" data-scroll-target="#preprocess-the-dataset">Preprocess the dataset</a></li>
  <li><a href="#load-a-base-model" id="toc-load-a-base-model" class="nav-link" data-scroll-target="#load-a-base-model">Load a base model</a></li>
  <li><a href="#evaluate" id="toc-evaluate" class="nav-link" data-scroll-target="#evaluate">Evaluate</a></li>
  <li><a href="#train" id="toc-train" class="nav-link" data-scroll-target="#train">Train!</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2024-10-10-(강의) 이미지캡셔닝.out.ipynb" download="2024-10-10-(강의) 이미지캡셔닝.out.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">(강의) 이미지캡셔닝</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>신록예찬 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="cell-1" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Transformers installation</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">!</span> pip install transformers datasets</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># To install from source instead of the last release, comment the command above and uncomment the following one.</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># ! pip install git+https://github.com/huggingface/transformers.git</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="image-captioning" class="level1">
<h1>Image captioning</h1>
<p>Image captioning is the task of predicting a caption for a given image. Common real world applications of it include aiding visually impaired people that can help them navigate through different situations. Therefore, image captioning helps to improve content accessibility for people by describing images to them.</p>
<p>This guide will show you how to:</p>
<ul>
<li>Fine-tune an image captioning model.</li>
<li>Use the fine-tuned model for inference.</li>
</ul>
<p>Before you begin, make sure you have all the necessary libraries installed:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">pip</span> install transformers datasets evaluate <span class="at">-q</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ex">pip</span> install jiwer <span class="at">-q</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We encourage you to log in to your Hugging Face account so you can upload and share your model with the community. When prompted, enter your token to log in:</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># from huggingface_hub import notebook_login</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># notebook_login()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-the-pokémon-blip-captions-dataset" class="level2">
<h2 class="anchored" data-anchor-id="load-the-pokémon-blip-captions-dataset">Load the Pokémon BLIP captions dataset</h2>
<p>Use the 🤗 Dataset library to load a dataset that consists of {image-caption} pairs. To create your own image captioning dataset in PyTorch, you can follow <a href="https://github.com/NielsRogge/Transformers-Tutorials/blob/master/GIT/Fine_tune_GIT_on_an_image_captioning_dataset.ipynb">this notebook</a>.</p>
<div id="cell-7" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> datasets <span class="im">import</span> load_dataset</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># Conceptual Captions 데이터셋 불러오기</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>ds <span class="op">=</span> load_dataset(<span class="st">"conceptual_captions"</span>, split<span class="op">=</span><span class="st">"train"</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Dataset({
    features: ['image_url', 'caption'],
    num_rows: 3318333
})</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>ds[<span class="st">'caption'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>['a very typical bus station',
 'sierra looked stunning in this top and this skirt while performing with person at their former university',
 'young confused girl standing in front of a wardrobe',
 'interior design of modern living room with fireplace in a new house',
 'cybernetic scene isolated on white background .',
 'gangsta rap artist attends sports team vs playoff game in the borough .',
 'the jetty : different types of plants to establish a variety of ecosystems .',
 'traditional ornamental floral paisley bandanna .',
 '# of the sports team skates against sports team during their game .',
 'by geographical feature category or in the city - a dome for every environment',
 'a flight was traveling when the animal got free on tuesday night',
 'even though agricultural conditions are not ideal for growing tobacco , there is indigenous production .',
 'us state speaks during a demonstration thursday .',
 'actor arrives for the premiere of the film',
 'celebrities start decorating for the christmas season lifestyle',
 'functions of government : 1 . form a more perfect union',
 'actor attends the premiere of season',
 'american football player on the field during joint training camp .',
 'companies have gone to court for the right to lie',
 'all shots by by person and rider shots can be found on his website .',
 'photo of a deer and wildfire',
 'high angle view of a businessman lying on a table and singing',
 'this is real fast food !',
 'safe deposit with money around it on a white background photo',
 "the giraffe before he was shot dead then autopsied in the presence of the zoo 's visitors , despite an online petition to save him signed by thousands of animal lovers",
 'dunes lay the blueprint for the back nine .',
 'portrait of a smiling woman stroking her dog lying on couch',
 'young business woman on a bench',
 'american football player looks downfield during the second half of a football game against sports team',
 '... and local people to deliver a new bridge',
 'actor arrives to the premiere',
 'funny animals of the week , animal pictures',
 'see the inspiring way this woman documented her travels on her prosthetic leg',
 'the sign promises as much as the glorious blue sky .',
 'architectural details of a bridge',
 'people tour and enjoy the public park during summer',
 "interesting 1930 's poster for a cosmetic company with stores .",
 'racecar driver steers his car during video game subject .',
 'vintage elegant floral card with frame decorated with black and white lilies on a pink background .',
 'heavy snow falls over a snow lined river .',
 'bright living room in the attic',
 'pop artist attends the 3rd annual at guest house',
 'illustration of a map , its flag and a comic balloon with a soccer ball in a not allowed signal',
 'rock artist performs on stage at awards held',
 'green sea turtle isolated on a white background 3d illustration',
 'person , was surprised by the staff',
 'red and white flag on the mast',
 'football player celebrates scoring for football team against football team in the final',
 'concept plug - in hybrid car on display',
 'a pencil drawing of a zebra and her baby .',
 'airline -- reasons why person leads the way in experience',
 'ninety per cent of the units have balconies with views .',
 'a demonstration of a group of people practicing their rights',
 'actor and daughters uk premiere held',
 'a fine , grainy vector pattern in black and white .',
 'seamless border of orange roses and paisley , pattern on a white background .',
 'students in front of a school',
 "museum , opened is among the 20th - century 's most significant buildings .",
 'river as it meets bodies of water where airline meets',
 'young rock star jamming on a guitar',
 'a moored fishing boat viewed from island .',
 'vector illustration of person isolated on a white background',
 'emergency services were called after a car smashed through a set of traffic lights',
 'sheep with a black face fenced in on a winter day',
 'a small park with flags and a yellow banner around a tree in support of troops',
 'isolated water glass on a white background',
 "when choosing your new outdoor color palette , opt for something that will enhance your home 's architectural style and give you plenty of curb appeal .",
 'person at a corporate event',
 'bulldozer on a building site',
 'person finishes at the top',
 'country shape animated on the satellite map of the globe',
 'paths are clearly marked with signs like this .',
 'putts for birdie on the second hole during the final round of the golf tournament .',
 'person shot from a cliff looking out at the lake and horizon .',
 "sending this angel your way ... it lights the way with it 's tiny candle .",
 'i love the colours of her clothes .',
 'a very simplified location and geological map of the area and adjacent coast',
 'ask owner for photos of the car',
 "the state of the world 's forests",
 'the mountain slopes covered with powdery snow are popular with visitors , especially foreign tourists',
 'farm tractor is moving on the field , cultivating land',
 'master playing with his little golden retriever dog on the lawn',
 'year later the small shrubs doubled in size .',
 'according to the model , she regularly gets told it looks',
 'person and the fiancee at their engagement party .',
 'good night id been working like a dog i should be sleeping like a log',
 'the water was never deeper than your chest .',
 'twilight over italian gothic structure and the medieval town',
 'a simple wedding cake with lego bride and groom topper and cake pops .',
 'simple custom leather pulls for your dresser , cabinets , or doors .',
 'sunny woodland morning along river .',
 'person , why u turn me on with your designs ? i believe i will bepinning some more of his work here in a bit .',
 'pop artist performs on stage .',
 'industrial plants in the distance at night',
 'building and skyscraper light up at night',
 'actor is an actor who started out as a lawyer .',
 'color good with green couch in living room ... favorite ... i think maybe a little too peach ?',
 'the villas from the front',
 'tree branches swing at real time with the wind while clouds move fast in time lapse',
 'my coffee of the day !',
 'mirror image : lonely kitten seeks comfort in the form of a cuddly cat',
 'this trick really is the best way to cut corn off the cob , because it saves making a big mess on the counter and floor .',
 'portrait of young mother and little child brushing their teeth together while standing in the bathroom',
 'the harbor a small village',
 'a traffic sign warns of surfers crossing !',
 'greeting card with bright blue text and abstract christmas tree on a white background vector art illustration',
 'such pretty watercolor flowers and can be in any languages',
 'newspaper became a free newspaper',
 'ancient open prairie of west on a cold morning beds and grasses cover much of the area',
 'forest on a sunny day',
 'happy senior couple with dog on a hike in summer in the nature',
 'illustrator who has a rather simply haunting style .',
 'birds fly up to the feeder and take seeds , snow on trees , falling snowflakes for the birdhouse',
 'hands in \\ walking through his old elementary hallways , person is congratulated by current students .',
 'leopard dragging its kill in the desert',
 "on a lovely winter 's evening .",
 "first screenshot of the conversation between users , where one abruptly finds out that they 've been reading a version of harry potter .",
 'taking to the streets : person is psychedelic rock artist in this mock up of their album cover',
 'butterfly on a yellow flower',
 'glass of whiskey with ice on the table',
 'vector illustration of a flat design of the house',
 'police car approaching a building by night',
 'the best gift for photographers - wrist strap - black / blue - lucky camera straps - genuine leather camera strap personalised handmade',
 'blue and pink wavy shiny ribbon on a dark background vector',
 'fit man stretching and listening to music by the sea',
 'biological species scratching an itch against a tree',
 'a slideshow of some of the best tiny houses available',
 'flag and festive cake on a plate',
 'could make the hallway to the master suite all glass to add some additional separation interesting !',
 'wedding dress with a v neck',
 'bride at the barn at high point farms',
 'coach and person react against basketball team during event .',
 'portrait of a happy young man in a red wig',
 'a necklace , charm bracelet and set of earrings with logos .',
 'this castle dates back to the 19th century .',
 'person finally get their hands with win',
 'images from the girls basketball game .',
 'the nerves of the knee',
 'funny pictures of the day',
 'the sign for a city .',
 'pop rock artist in the audience during the event',
 'young woman lying in the grass',
 'a person with a cloud .',
 'person is available with a gift box .',
 'square greeting card with image of a snowman holding a twig with ball on the background of winter trees .',
 'sheep grazing on the highlands .',
 'people pouring water on the hands of monks',
 'buildings of bright red and yellow line the harbor .',
 'all - in - one beard , hair &amp; body trimmer',
 'we have been celebrating western christian holiday with decorating trees together and have collected a wide range of ornaments in that time .',
 "person and battle for position at the end of thursday 's race .",
 'breakdown of the car on the road .',
 'these are the most beautiful flowers on a cake i have ever seen .',
 'proper proportions for a parachute dry fly',
 'decorative bottle stand for wine in the form of a heart on a wedding theme .',
 'a fashion look featuring blouses , peace of leggings and boots .',
 'a group of water lilies',
 "when the weather gets cold it 's a sign to me that it 's time to bake !",
 'soccer player , who led forward line , and person embrace as they make their way off the pitch',
 'a young female pharmacist standing at the counter and showing a box of pills in the pharmacy .',
 'freedom - happy free man in the car',
 'a durable , attractive metal black wand with gold - colored metal tips .',
 'lion laying in the grasslands',
 'wanting to settle in for the winter .',
 'homes for sale located in the city',
 'speed on a boat or cruise through on the river',
 'a stolen motorcycle was recovered from the home of person , police said .',
 'person stepping into the freezing water',
 'latin pop artist performs live in concert',
 'part of a car garage .',
 'this site is really worth noting lots of information .',
 'heart shaped on hands forming a heart shape',
 'waiter picking up food from the kitchen',
 'save organisation : photos outside government agency',
 'an artist selling his work',
 'football player is next , and the midfielder has gone for the unkempt look .',
 'a box of toys on sale at a market',
 'person is coming maps reveal the first days of snow',
 'shore : the tree in the ocean',
 'bride just after the wedding holding her bouquet of flowers',
 'film director and actor attend award held',
 'portrait of a young japanese woman',
 'person on the movie scenes',
 'artist of musical group performs at day of the festival .',
 'basketball point guard looks to pass the ball against sports team .',
 'have you come across industry ?',
 'rugby player passes the ball during a training session .',
 'set of ribbons isolated on blue background .',
 'actor is photographed for the observer .',
 'vector illustration of a banner for festival .',
 'no leaks reported after cars derail east .',
 'the home of ice hockey player is on the market for $3.9 million .',
 'person as a child , with her mother .',
 'a snapshot of our office .',
 'image detail for - fashion',
 'football player pulls a face for the camera during a photo call',
 'map showing routes of principal explorers , from 1501 to image detail',
 'foal in front of a white background',
 'large set of plastic bottles isolated on black - the waste we produce',
 'an illustration of hands holding hearts to each other vector art illustration',
 'vector cartoon illustration of person with foot in the grave',
 'the batteries are tucked into the trees on top of the bluff overlooking strait .',
 'actor , 1950s , when she was in her twenties -- the most beautiful woman in the world at that time',
 'a girl spends time outdoors with her pet bearded dragon',
 'plants for sale in a nursery',
 'christmas tree with balls top view on a white background .',
 'step by step ... 2',
 'art meets science at a wonderfully weird wedding',
 'vector of a logo on a white background .',
 'dry autumn oak leaf with water drops after rain in the forest park',
 'create a safe environment at home for your child to thrive',
 'landscape with mown grass and a haystack .',
 'pair of hands holding our planet with icons on a white background',
 'set of seamless patterns with snowflakes .',
 'put all the extraordinary things that are not ordinary , simple things to do everything on that simple .',
 'illustration of a pattern with funny abstract plants',
 'geographical feature category partially screens the entrance to the lighted underground grotto',
 'remember what true love is',
 'view from the beach ... paradise !',
 'person is one of the exhibiting artists at an exhibition which explores our physical and spiritual connection with nature',
 'actor arrives at the premiere',
 'property image # mobile home by the sea and beach , . series',
 'aerial view a line irrigate channel with water for irrigation of agricultural fields',
 'green fruits and vegetables in the shape of bathroom weighing scales over a white background',
 'a monument was unveiled on the premises',
 'peaking through the blossoms to catch a glimpse .',
 'before the storm hit a city on wednesday morning , there was not a cloud in the sky .',
 "this big , beautiful gingerbread involves more spices than just ginger , but you know it 's in there , doing good work .",
 'aerial view of the highway between agricultural fields',
 'a couple years ago , i got this tattoo so i could have more opportunities to share my story with people .',
 'man and woman on a dark background .',
 'misty light over the valley , with a griffin vulture soaring',
 'a forest of stunted trees that stand in sharp contrast to the giants of the other forests',
 'person bows at the curtain call during the press night performance',
 "it 's a tower : their wedding cake consisted of layers and an abundance of flowers",
 'the bucket list , panoramic view of city .',
 "here 's that motorcycle themed accent table that you 've been looking for .",
 'pair of women in a pineapple - themed car',
 'christmas bell with a bow -- stock photo #',
 'dubstep artist performs onstage during day of festival',
 'a palm tree with flowers in tropical country',
 'baseball player winds up for a pitch on the mound during a game 1980s',
 'cars trucks driving on the highway',
 'the audience at the concert on ship',
 'image may contain : person , on stage , playing a musical instrument and concert',
 'dog wears a shirt during a presidential candidate campaign event .',
 'media during the final round',
 'homeowners get this outdoor heated swimming pool set within the sprawling grounds of the property',
 'the chapel in the castle',
 'vector image of a poisonous mushroom .',
 'i like how simple this looks .',
 'footage of scattered clouds over the winter sky at sunset time .',
 'making a cable we will have a lab on this later .',
 'hipster cat in a hat and with glasses .',
 'dramatist at a typewriter with a finger on his lips in a scene from the film',
 'silhouette and colored maps with flags',
 'actor attends the world premiere of crime fiction film',
 'monarch and chivalric order member are seen upon arrival at the 60th anniversary ceremony of the foundation .',
 'close up of droplets of water projecting an image of a flower from behind',
 'room of noble person , looted during the revolution',
 'aerial : woman waving her arms on the rock',
 'steps to creating a custom christmas tree',
 '7x7x7 ball in product category',
 'a cottage in the picturesque village',
 'person arrives to the premiere',
 'passenger train in special livery speeding through the countryside',
 'a double rainbow over a gazebo',
 'pheasant released for a shoot',
 'horse riding on the beach at sunset',
 'the couple and their daughters , between the ages of 13 and 22 , were on board the ship as part of a family vacation last month',
 'open shelves in a white kitchen',
 'a poster from the new still .',
 'flying over a field near the factory .',
 'bay viewed from a seaplane',
 'person performs onstage during the summertime in the festival',
 'me walking at the tea plantations',
 'bride &amp; bridesmaid enjoying the photo booth at a wedding reception',
 'a city and a suburban rooftop fitted with off grid solar energy',
 'the traditional charm of the classic wooden kitchen designs',
 'welcome to vintage rusty metal sign on a white background',
 'marine iguana basking in the sunshine to warm up before feeding',
 'and its surrounding waters were declared an ancestral domain for ethnicity',
 'person and battle for the ball',
 'view of the village by painting artist',
 'actor attends premiere during festival .',
 'actor and equestrian on the runway at the show .',
 'the lobby was decorated for western christian holiday .',
 'some of the girls at made to code',
 'a beautiful night brought out the crowds as temperatures dropped into the sixties .',
 'got off to a wet start',
 'hand drawing of a raging bull',
 'models of all ages at show at graduate week',
 'a large alligator rests on the shoreline beside water on a sunny day .',
 'illustration of an ice cream #',
 'plant dense cluster hanging in the water',
 'i could see something like this for your hair with maybe a fun headband or clip .',
 'this but with a little less man cave , more windows , darker walls and wood .',
 'aerial view of sculpture on a summer spring day at sunset .',
 'this could be another broken heart , or is it where true love starts ? way to find out if this thing is real , just spin the wheel .',
 'happy cat in a hat holding a glass of wine and peeking from behind empty board .',
 'the cover of issue by person',
 'welcome in from the cold .',
 "life 's a beach : the iconic dome against a blue sky this summer .",
 'happy toilet seat in a hotel',
 'whiskey on the rocks and scholar books -- stock photo #',
 '... person made her appearance in a beautiful royal gown .',
 'a male surfer does a bottom turn while surfing .',
 'a sign being displayed outside on of the tents reads families together',
 'sport and the effect on the body',
 'military parade on the area',
 'person competes , takes a time out to smile for the camera .',
 'country artist captured a surprise concert by his daughter .',
 'a cart full of sandals and flip flops',
 'a green sea turtle hovering over a reef is cleaned by a school of fish .',
 'actor attends the world film premiere of comedy',
 'artist performs on the main stage during day',
 'christmas decorations on the exterior of department store',
 'happy to be here : person showed off a smile as he posed for the promotional event',
 "family : after the youngster 's reaction to his birthday party , thing is clear .",
 'a city from the top',
 'head of the beast , illustration',
 'you have to see these easy ornaments for the holidays !',
 'comedian during an interview with comedian --',
 'rhythm and blues artist and singer attend the premiere .',
 'a simple lizard done in a woodcut style .',
 'time to market , portrayed the bridge over person',
 'football player spent time on loan as a kid',
 'an unique experience in an urban environment , a winery .',
 'football player collides with football player as he punches clear under pressure from football player during the round of 32 , match',
 'vector silhouette of a dancing couple on a white background .',
 'cinematic aerial shot of the dramatic coastline at the cliffs close to the famous waterfall',
 'the family dog resting inside the home',
 'a model walks the runway at the winter fashion show during event .',
 'haircuts that make your face look thinner well done for anyone who wants a comfortable appearance',
 'mural , at the post office .',
 'children in the reading room .',
 'reflection of a boat on water',
 'a small waterfall flows over a rocky cliff',
 'yellow pumpkin with a bow in the pants and shoes , keeping the tape with the text .',
 'i would by this simply to have a truck that no one else does .',
 'images regional final boys basketball game .',
 'one of the most dramatic mountain ranges i have seen',
 'clouds lying low over a lake',
 'olympic athlete and entrepreneur attend the premiere',
 'car with no driver in a rural scene',
 'type of place of worship : the largest',
 'some kind of spring ~',
 "somewhere between here and there , there 's always space for hope .",
 'happy children plays on the sea beach',
 'is your dog ready to take the test ? we will be holding the test',
 'image may contain : person , playing a musical instrument , on stage and night',
 'would you still want to eat the food if someone coughed on it',
 'the cub climbed a tree in an attempt to get away from her siblings , now set on getting her back',
 'peek - art print by person in beautiful frame options and a variety of sizes .',
 'a cartoon illustration of a cat in a witch hat with a goofy expression',
 'tall grass in the fall',
 'actor arrives at the premiere .',
 'a repeating pattern of a hibiscus flower .',
 'first time in snow on the trail !',
 'elegant staircase with glass rail and wooden steps steals the show',
 'abstract pattern in the style of large white spots and little green with black dots on a pink background',
 'make - ahead meals for the whole month',
 'christmas tree in the forest',
 'super slow motion of middle - age woman hands with scissors cutting white fabric on a tabletop',
 'a creek flowing through a forest of dead trees .',
 'blonde labrador retriever in snow on a shoot day',
 'an overview of 1950s fashion is featured , with a look at popular fashion trends in the 50s and how to dress 50s with your everyday style .',
 'father and daughter swimming at the pool',
 'river dries up with the arrival of winter season .',
 'christmas fir tree on the wooden board',
 'australian rules footballer of australian rules football team speaks with australian rules footballer during a training session .',
 'luxury : living areas of the property include a modern open plan kitchen and a timber floored lounge and dining rooms , which feature a fire place',
 'illustration of a magnifying glass over a blue background',
 'cute girl hiding her face under the red fan .',
 'swing artist and his wife arrive at the premiere screening of the new - disc dvd featuring from the historic charity concert .',
 'girl sitting on a park bench after running',
 'tiny artificial stream flows under the bridge',
 'how to draw a step by step easy for beginners',
 'some of the finest footwear in the city',
 'christmas tree with decorations in the living room .',
 'is going up for auction with a starting bid of $5 .',
 'creative typographic poster or a stamp on a black circle silhouette isolated on white background for online stores and supermarkets selling natural products .',
 'person , left , scores past baseball player during the eighth inning of a baseball game .',
 'damaged brickwork on a building in a city',
 'scenes of boats in the ocean',
 'every skier should ski a city .',
 'come home to apartments today .',
 'a city was once intended to rival french baroque structure .',
 'person challenges with person during the match .',
 'young beautiful sensual couple standing and hugging outdoor in summer in the field together behind rainy sky',
 'taking a glass of wine',
 'film producer attends the premiere',
 'texture of the red brick wall as a background',
 'vintage weddings on a lake',
 'myths about heating your home which will help you save money',
 "time for a shave ? while he 's sported a beard before , it was especially long for the outing",
 'japanese city skyline viewed from the castle',
 'fans get ready prior to the game against sports team in broadcast genre of the quarterfinals .',
 'how will you go red ? help us raise awareness of the risks for women and heart disease by being part of the movement !',
 'a sand sculpture is modelled .',
 'business man in his office working on a laptop computer .',
 'a rare example of a document .',
 'pieces of wood showing the variation in tone , shade and hue the dying process can create',
 'picket fence and a city',
 'close - up face of a young girl who sings a song on nature',
 'old fishing boats beached on a coastal beach in countryside',
 'hobby on the subject of art and craft .',
 'vector illustration of a young woman',
 "a bird 's - eye view from 102nd floor",
 'law enforcement officials are seen were an officer - involved shooting took place .',
 'houses , wear special decorations as the city prepares to celebrate western christian holiday .',
 'medium shot of the manicured gardens .',
 'one of the many bridges i had to cross during this ride .',
 'person brings the ball up court against american football team during a semifinal game of the basketball tournament .',
 'rugby player arrives for a training session .',
 'lightning in shape of the letter c',
 'little boy learn to write on a blackboard in the kindergarten or the classroom',
 'aerial view , sharp turn down to beach view from the cliff .',
 '4k young child typing on a keyboard in the dark at night , in slow motion',
 'geographical feature with crashing waves at daytime',
 'a city today against a modern skyline',
 "this year we 're bringing you even more halloween costume ideas for guys with beards and mustaches !",
 'music video performer performs on a suspended stage above his fans',
 'seniors on the tennis court',
 'person is playing his 10th season with the team',
 'here is a close - up view of the pattern .',
 'the boiling cauldron of potion for western christian holiday .',
 'the bride dances with her papa at her rustic wedding reception',
 'music video performer performs during festival .',
 'poetry book , written by author',
 '... cookie recipe for an extra special combination .',
 'filming location is home to the largest urban colony of free - tailed bats .',
 'bride walking through the bridge with all of her bridesmaids',
 'multiple lanterns being let go into the sky',
 'hands praying on poetry book',
 'continuous line drawing of a horse',
 'person and celebrity at the premiere .',
 'northern cardinal perched on a branch during a heavy winter snow storm',
 'soccer player controls the ball during a training session .',
 'hand drawn beautiful cute girl on the background of city .',
 'knowledge is power - the more you know , the better you can advocate for your child .',
 'reproduction of painting near the house from the collection',
 'ultralight powered parachute flies over farm land with mountain in the distance .',
 'firefighters rescue a driver after a crash .',
 'the birthday cake with candles in the form of number icon .',
 'portrait of garage rock artist',
 'illustration of a double a battery',
 'portrait of an angry spanish man with glasses and beard .',
 'a group of people riding camels through the desert at sunset , experience included in the ultimate guide .',
 'students writing during an exam',
 'bushy willow over the lake in the fall .',
 'star wars tattoos that will awaken the force in you',
 'bathroom : simple bathroom designs grey',
 'the public house traditional pub in old building on corner',
 'christmas lights in an expensive shopping center with cars parked in front of a store',
 'actor attends the promotional event for watches',
 'the large trunks of eucalyptus trees lining a country road',
 'classical artist in action during the match .',
 'actors arriving at the premiere',
 'basic font for flat white icon in the orange circle .',
 'newly engaged couple , in an outdoor engagement session .',
 'a mix of rhododendrons and native plants .',
 "the queen 's baton carried by people",
 'get in touch with the depth of the bright blue sea with its clear water and unspoiled white sandy beach',
 'pictured is one of the old buses .',
 "the hand - painted movie poster for 1939 's epic film starring actor as film character",
 'vegetables in a wet market',
 'property image # newly built small house next to the sea and the beach',
 'person performs live during a concert .',
 'the sharp spikes of the shell',
 'young lady waking in a field at sunset',
 'pastel buildings along the river',
 'television show host arrives for the film premiere',
 'water drains from the fountain .',
 'pop artist performs on stage as part of festival .',
 'locked - on shot of rock formations on the beach',
 'walking through a city during the market , while waiting person who went back .',
 'person runs for a touchdown .',
 '# catches a touchdown reception against army during the first half of a college football game .',
 'girls night out party dancing to music waving hands in the air',
 'boy being kissed on both cheeks by parents , smiling at camera',
 'a lot of coins scattered on the table',
 'actor attends a baseball game .',
 'metal buckets in silver and black on a white background vector art illustration',
 'room for an extra couple of bodies to sleep on the hard floor .',
 'waves crash into the rocks',
 'woman taking a photo of cake with smartphone .',
 'an officer stood near firefighters as they responded to a blaze .',
 'in this image it has been taken of a close - up of a building in london which creates an interesting pattern from its',
 'linen for the perfect table',
 'rabbit sized style door in tree',
 'old sailing boat during a regatta',
 'a masked demonstrator carries a flare during a protest against proposed federal government reforms',
 'a model walks the runway at the summer fashion show during event',
 'kitty in a coffee cup',
 'comedian at the premiere of horror film .',
 'there is nothing more fun than giving endless head rubs to parrots. :)',
 'government agency drives along the fence that divides us state and constitutional republic',
 'close - up of a sandwich for lunch',
 'cat sits on the windowsill and looks out the window',
 'island on a snowy winters day',
 'come and try these flavors .',
 'resting during a game of golf circa 19501960',
 'how is western christian holiday celebrated around the world',
 'brand new quartz countertops , photos do it no justice , it sparkles like diamonds',
 'plate on a vintage car',
 'dragon on a white background , vector',
 'an illustration of a burning flaming baseball ball on fire tearing a hole through a brick wall',
 'contemporary christian artist album cover',
 'happy family : people , with people made a trip to the snow to celebrate the long weekend .',
 'actor wears a gorgeous blush pink coloured gown at festival .',
 'progressive rock artist and hard rock artist in performance on the tour',
 'teenage couple on the bench',
 'isolated image of the green cross on white',
 'bedroom : dark blue bedrooms for girls large painted',
 'latin pop artist performs a concert .',
 'eye on the ball : pop artist did his best to keep up with the pros , attempting to round person with a deft touch',
 'a striking injection of hot pink takes these woods from ordinary to extraordinary .',
 'person carves a lobster from a block of ice for the fundraiser on friday .',
 'a green landscape shot with leaves in the foreground',
 'joyful man sleeping and hugging a soft pillow up in clouds in the sky',
 'city of rugby players having half - time discussion in a game against a city',
 'the rotor is attached to the hub with a fair amount of torque and usually division .',
 'a perfectly timed action shot by person as a leopard jumps off a tree',
 'person and groom embrace at the altar',
 'person spikes the ball agains football team .',
 'students work together to prepare food before their activity begins .',
 'this is biological genus , suitable for containers .',
 'file photo dated on a production line .',
 'autumn landscape with fall leaves on the branches of trees',
 'parts of the fish and the function',
 'romantic couple of people sitting in a cafe drinking coffee .',
 'interiors of a dining room',
 'man lose his gambling with a glass of beer on the table , isolated on white background',
 'the cottage looks out at this view !',
 'state flag waving on an isolated white background .',
 'our promise is to give any child the best possible chance of success through a high level of support , care and compassion .',
 'vector illustration of modern single icon depicting a target',
 'how to choose bathroom tiles which are perfect for your bathroom',
 'woman doctor with a stethoscope .',
 'couple having a toast inside jet airplane',
 'while i was waiting for a solitary bee , this insect strolled in .',
 "children 's bedroom with single beds , which is located in the beautiful greek island",
 'illuminating : a runner jogs past a patch of intense light on the road',
 'american football team huddle up before the game - 1280x853',
 'love the smell of a spring morning after rain',
 'castle on the west coast .',
 'architectural style an ornate window',
 'a model walks the runway at person fall fashion show',
 'hispanic canned beans in a supermarket are seen .',
 'chef holding a boiling hen sitting in a pot',
 'celebrity style for less all at or around $100',
 'watercolor christmas tree isolated on a white background .',
 'pie with candles and gifts in boxes on a white background',
 'football player passes the ball during the pre season friendly match .',
 '2nd maneuvers a rigid - hull inflatable boat near the aircraft',
 'young woman in a shop buying clothes -- stock photo #',
 'between the trees , the northern lights glowed .',
 'the interior of hotel and casino',
 'cheeky children pulling funny faces at each other whilst laying on the floor',
 'sunny winter day in a snow - covered spruce forest at snowfall .',
 'a model walks the runway during the show as part .',
 "wind and gas projects highlight the country 's commitment to renewable energy .",
 'the doors with the stone texture',
 'carved stone animals on a public fountain',
 'vintage vehicle in the car rally',
 'the transition from weekend mode to monday mood sometimes may weaken our spirit .',
 'icon digital red for any design isolated on white',
 'big laundry room with shelving .',
 'burger : pound of fries and some sauces',
 'kids having fun with each other during birthday party at home 4k',
 'automobile model in the rally',
 'baseball player , left , scores past athlete during the fifth inning of a baseball game .',
 'wild koala sitting in a tree',
 'red fox among the flowers',
 'looking into the kitchen and living room',
 'ancient ornamental clock face with roman numbers isolated on a white background photo',
 'an image of a hand holding an universal remote control .',
 'stairs to the pool , reflection in the water',
 'on a hill far away',
 'football player plays for football team versus football team in the championship',
 'suburban home in autumn sunshine as the leaves turn orange &amp; yellow',
 'new school style tattoo on the left calf .',
 'a collection of fruits and vegetables beside each other .',
 'no swimming sign at ocean shore',
 'actors attend a private reception for the premiere of the short film .',
 'abstract cute clown on a white background .',
 'cricket player in action during the match against cricket team .',
 'hard rock artist during a performance',
 'out mountains are thirsty &amp; waiting for the white snow to irrigate it &amp; ...',
 'horticultural technician cleans out a tree',
 'vintage metal lock on a gray door .',
 'sports equipment features hull material and a molded seat with an adjustable , padded back rest .',
 'city in the sky by person',
 'actors pose during an event forbrand .',
 'pictures of plants that grow in winter',
 'a circular dining table is seen surrounded with chairs in the house',
 'hip hop artist performs as part of the tour',
 'fans anxiously awaiting the gates to open for festival .',
 'phantom of the opera inspired prom dresses',
 'silhouettes of a gymnastic girl .',
 'teen pop artist arrives at the premiere',
 'image may contain : person , on stage , standing and playing a musical instrument',
 'horse grazing on a summer meadow in the forest outdoors',
 'road in the mountainous area',
 'person arrives at the 48th annual awards red carpet',
 'concept illustration showing a magnifying glass over a few footprints',
 'illustrated corn on the cob with green and yellow royalty',
 'film character added to a skull .',
 'ducks by the water in a public park',
 'view the church is called gothic structure and is one of the main churches',
 'actors attends the series at build studio',
 'american football player runs for a touchdown against sports team during the second quarter of a football game',
 'actor and novelist attend the film premiere',
 'i would go because of the beautiful land and mountains',
 'various spices forming the flag .',
 'a growing plant in a forest',
 'a group photo of the students who attended the event and got their certificates .',
 'stacked eggs in the shape of a graph , isolated on a white background',
 'close - up of person singing at festival',
 'author and actor attend the premiere .',
 'actor arrives at the premiere',
 'big snow from the train',
 'artist and pop rock artist attend clothing business by fashion show .',
 'the wedding featured in issue of no . magazine .',
 'little boy and his sister with father playing together on the tropical beach .',
 'the sun setting over the scorched forests .',
 "person is considering taking legal action against the glue 's manufacturer .",
 'dog in a kilt :)',
 'a trio of officers stroll .',
 'an apple on a stack of paper , close - up',
 'tennis player drops to his knees after defeating tennis player .',
 'the letter p spelled using balls , isolated on a white background',
 'venture funded company called these sugar - glazed , slow - smoked ribs',
 'puppy sitting in a basket with easter eggs and grass on a white background .',
 'the moon in the black sky at night',
 'person curved bright corridor with light passing from the turn',
 'i like how they chose a fast shutter speed and captured the water around the bear',
 'the magnetic field and electric currents generate complex forces that have immeasurable impact on every day life .',
 'images from the girls basketball game .',
 'the tunnels in old city',
 'woman with a yellow measuring tape around her mouth , isolated in green',
 'wrinkled frog : an endemic to western ghats',
 'do you have a big decision to make , and you are wondering -- should you pray to deity for a sign ? here is what poetry book says .',
 'farmer plowing the field with his cattle',
 'a man and boys on a steep slope herding cows and goats',
 'block diagram of the experimental setup',
 'love is like a beautiful flower ...',
 'icon illustration of a handball player jumping throwing ball scoring set inside circle on isolated background done in retro style .',
 'view of the street from pool area',
 'film character and person attend a screening',
 'business executives discussing in a meeting',
 'vase with flowers and book by the window',
 "a close - up detail shot of a woman 's shoe with funky laces on a pink background",
 'gold snowflake on a red background .',
 'ice is shown on street signs as people make their way through rain and icy conditions as canadian census division was hit by an ice storm .',
 'after the snowfall ; snow covered residential street',
 'happy young man jumping in air with arms extended on a city background',
 'image may contain : person , on stage , playing a musical instrument and indoor',
 'the man in the gym',
 'interior design ideas for temple in the home',
 'silhouette of a pregnant woman free vector',
 'paradise : she has been staying with her partner , and geographical feature category',
 'animal sits in grass in the state',
 'portrait of a bride and person overlooking mountain after their wedding',
 'black matte with a touch of pink .',
 'motion in the winter forest',
 'group of sardines on a colorful bench for sale in fresh seafood market .',
 "this was last year 's tree .",
 'person and actor pose at awards',
 'models walk the catwalk during the collection show part of spring summer .',
 "actor attends the festival 's 26th opening night awards gala .",
 'rehearses ahead of the premiere .',
 'the quintessential cocktail , is one of those drinks that never go out of style .',
 'flame of fire with sparks on a black background',
 'baseball player , tries to steal home during sports league championship against sports team .',
 'isolated cute elephant on a white background',
 'an old worn out fence at the edge of woodland',
 'camper van under the stars',
 '3d illustration of a capsule punching a virus',
 'handshake of businessmen on the background of night city .',
 'politician walks on stage to deliver remarks on the first day',
 'the playground equipment is going to be replaced with a large play area that will include a replica .',
 'young man in jacket walking on the wooden dock in harbor with boats around',
 'shopping center is one of the largest and oldest covered markets in the world , with covered streets and shops which attract visitors daily .',
 'the autumn bedroom apartment -- for sale &amp; rent --',
 'the pattern with decorative ornament in vintage style',
 'lightning strikes the ground and flashes across the night sky',
 'beaches , mission : hundreds needed to take part',
 'little girl holding a sheet of cardboard .',
 'row of white wind turbines in motion on a cloudy day',
 'cheerful snowman in a hat with green scarf , cute',
 'football player looks thoughtful during the match .',
 'person wants this cake for his birthday',
 'aerial view of a sunset in a mountain village',
 'the living room and house faces the swimming pool .',
 'a young person with a hoodie thanks with person together',
 'a mix of glass candlesticks and vases topped with lush white flower arrangements had a clean yet glam look .',
 'cashier working at a supermarket',
 'the men play kiss , kill , marry',
 'view of a loch and pine forest .',
 'soccer player navigates through the defense during a soccer match',
 'woman in hard hat and fluorescent vest taking stock in a warehouse',
 'new apartments are planned for the upper floors',
 'break out the no - no juice !',
 'furniture falling through a hole in the floor above .',
 'informational signs on the tour',
 'this the suit my design team choose for me to wear for the interviews .',
 'unidentified women in traditional clothes .',
 'beautiful pink and orange wedding bouquet by person !',
 'actor and artist attend the premiere .',
 'family buying vegetables in a supermarket',
 'what the text is about and why it was written',
 "the bride 's cake was made by person .",
 'railways and trains made of lego or straws in a toy naive fashion',
 'birds fly over the river in the rays of the orange sun at sunset',
 'stripes and a tulle skirt with black perforated heels and gold jewelry',
 'actor at the premiere held .',
 'pop artist attends the film premiere .',
 'the impressive facade opens to many surprising features .',
 'actor , his wife and family arrive at the premiere',
 'person and actor attend red carpet',
 'a blend of abstract shapes and shades .',
 'sports league championship : sports team at baseball player gives the thumbs down sign after hitting a double in the second inning .',
 'back in the 50s , haircuts were all the rage for women too',
 'laughter during a wedding ceremony',
 'comic book character - from superhero to person !',
 'live crabs on a green background',
 'person moved from the bedroom to the living room',
 'parliamentary republic extruded on the world map with administrative borders and graticule .',
 'city , rain soaked streets in the old town',
 'snow and palm trees - the view from the window at the conference !',
 'snowy mountains reflect in the lake royalty - free',
 'cricket fans celebrate after their captain scored runs during the match .',
 'tourist attraction from the trail',
 'elderly woman enjoying the view of the ocean from a bench on a pier',
 'animal dressed as a chicken',
 'a bride in her wedding dress',
 'male hand holding a human skull in the air .',
 'black bicycle isolated on a white background',
 'seals fighting for a spot to sleep on the rocks',
 'hang them with chains in your play area and let the kids enjoy their time .',
 'person and father of the bride crying .',
 'actor arrives at the premiere during festival',
 'leaves on the bridge and koi fish',
 'soccer goalkeeper reacts during the clausura liga mx',
 'ways to make the most of your laundry room',
 'an appearance on the big stage in the blood of many artists',
 'soldiers march during a military parade as part of celebrations .',
 'policeman on the motorcycle passing quickly through fields of grain',
 'a grasshopper on a tiled bathroom floor',
 'these pencils that grow into plants .',
 'flat paper cut style icon of a car',
 'vector illustration of abstract icons based',
 'young woman get out of the car near the road',
 'rock and roll artist performs',
 'artist performs live on the stage .',
 "the crowd at last year 's expo .",
 'a set of birds drawn with curves',
 'view from a roof terrace',
 'family picnic with a dog',
 'hiker with map on a trail .',
 'teenage boys pitching a tent at the lake in forest',
 'think the slow cooker is just for meat ? no way !',
 'toothpaste and toothbrush in a glass',
 'couple dancing at party and enjoying each other , black silhouettes of woman wearing dress and man in suit on vector illustration isolated on white',
 'a female waiting to cross a road and sheltering under her umbrella in a shower of rain',
 'interior design ideas for the kitchen and the different styles of cuisine',
 'map that i drew a while ago , just before we moved .',
 'yellow house on the hill and rainbow .',
 'father and little son are sitting by the window in evening and watching cartoons in tablet pc',
 'person , right , leaves to find her family after the commencement ceremony',
 'surfing in a giant ball at festival',
 'a model walks the runway at the show during ss14',
 'each of the bedrooms features furniture that has been designed by an internationally renowned artist',
 'operatic pop artist attends the royal world premiere held .',
 'a man walks his dog on a field in the outskirts , just before sunrise .',
 'people click into their skis .',
 'happy father and son smiling at each other',
 'person of a mother and child',
 'hand drawn vector illustration or drawing of a dove bird representing the holy spirit symbol',
 'person it is not possible for this to be any more darling !',
 'voters take part in the referendum',
 'caucasian family walking on a beach at sunset',
 'an illustration of a beehive suspended from a tree with bees around it illustration',
 'businessman with is ear to the grass',
 'actor and her son attends the premiere at person .',
 'person the erratic style of the artist is echoed on person',
 'doors lead to a verandah and gardens .',
 'television show host attends awards .',
 'a full cup of dark roast , cob , and matches ; all set to relax .',
 'happy and smiling woman walking and talking on the phone .',
 'a mom cleans &amp; plays with her baby .',
 'abandoned dock stretches out into the rippling waters of a loch under a clouded sky in beautiful high definition 4k',
 'a picture of a sparkling clean bathroom',
 'wooden sign isolated on the white background .',
 'no sign or symbol with long shadow',
 'apartment - free parking in the apartment building .',
 'actor , film director , and actors arrive for the premiere .',
 'dramatic sky with bell tower of person',
 'hip hop artist sings new songs from his latest album at festival .',
 'basketball shooting guard handles the ball during a game against sports team .',
 'actors looking at martial artist lying on a sofa in the film',
 "literally the funniest anime i 've seen in awhile !",
 "you 've never been on a bus like this .",
 'zigzag bridge steals the show in the garden',
 'award winner , signs autographs for the fans',
 'person and white goat eating green pasture on a cloudy day in a farm',
 'portrait of a white leopard snarling mouth',
 "person connects with a pitch for a hit against a city in the first inning of a boy 's district final game .",
 'winner of the silver and bronze medals ski jumper',
 'that is gorgeous lookin tattoo !',
 'portrait of a happy family with a pregnant mother',
 'festive interior of the room .',
 "if this was my bathroom , i 'd feel like i was in a hotel all the time",
 "it 's a photo of a young woman who is hiding herself behind her hands in a field or farm in the countryside",
 "stock image ofred european squirrel sitting on top of a green painted fence while it 's snowing .",
 'radio broadcaster takes you on an extensive tour as decorated for the christmas season .',
 'people waiting on the platform at the train station designed by artist',
 'over the mountains to a city',
 'artist and big beat artist of big beat artist perform live on stage',
 'actors attend the season premiere on the lot .',
 'view of the woods from the back of person .',
 'close - up eye of a large fish',
 'australian rules footballer stretches with team - mates during a training session .',
 'waterfall that drains crater lake',
 'ice hockey player defends the goal against sports team',
 'the donkeys rescued from the fair',
 'actor , celebrity , and author attend awards .',
 'a car parked outside a hotel displays a message .',
 'the doll has bent arms and adjustable legs .',
 "the bride 's father walking her down the aisle .",
 'small bridge in the park',
 'a stack of antique red leather bound books with gold lettering and details',
 'a car leaving parents house .',
 'folk rock artist and person arrive at awards held',
 'card with circular oriental pattern of floral motif on a dark blue circle .',
 'test form long shadow icon .',
 'homes for sale located in the city',
 'picture of tables and benches within the large dining space',
 'photograph of pink hanging flowers with a dark blue background',
 'actor and organisation founder arrives',
 'simple geometric shapes forming an abstract seamless pattern on textured background .',
 'abstract background with patterns like flower or a symbol embossed on the surface metallic blue .',
 'music fans during the second day of the music festival',
 'rusty nuts and bolts on a plain white background',
 'black and white photo of a newborn baby',
 'sun setting over the city',
 'sea waves running on the sandy shore leaving a foam in slow motion',
 'summer evening and tower bridge is illuminated by the fading light',
 'boy flying a kite in a field at sunset',
 'baseball player , left , celebrates with person after they defeated sports team in an interleague baseball game .',
 "try to be a rainbow in someone 's cloud . poet",
 "and again we would like to rejoice you with our elvish dress it 's the first time when it was ordered in such colours and unexpectedly for us we have got such an interesting result of combining red with silver .",
 'actors speak onstage during awards',
 "a watch on a swimmer 's arm",
 'shops in the typical market town',
 'cartoon illustration of the summer in the park with cityscape in background .',
 'person will have an art exhibit with her daughter',
 'walkway through sunken forest with eroded limestone at the exterior',
 'elegant rich gold metallic lowercase or small letter s in a 3d illustration with a golden yellow color and smooth metal surface classic font isolated on a white background with clipping path .',
 'train on a foggy day at station',
 'a young black and white spotted cow walks through a green spring field in the sunshine',
 'dolly shot of happy beard young man talking on the smartphone and drinking coffee while walking in the street',
 'casual this morning before switching to lighter clothes .',
 'image may contain : person , on stage , playing a musical instrument , concert , night and indoor',
 'check out the recipe for person and do give it a try .',
 'baseball player pitches against sports team during the eighth inning',
 'drink cups of green tea a day',
 'finally back to cracking blue sky !',
 'shiny red foil or rough textured metallic lowercase or small letter g in a 3d illustration with a wavy rippled surface effect and basic bold font isolated on a white background with clipping path .',
 'the pie munching capital revealed',
 'illustration of cluster of star in the space background',
 'sign on a fence around a field saying to prevent people hunting',
 'biological genus gathers pollen from flowers',
 'the can be found in the kitchen of the floor plan .',
 'postage stamp depicting the airship',
 'bee on a little yellow flower',
 'old buildings in a state of disrepair .',
 'healthy work : with team members , received an award from people .',
 'politician come down to support the event and give out awards to selected students photo',
 'philosopher inspects a plane he flies kids life - threatening illnesses to care .',
 'collage showing different phases of the geyser',
 'the bed in the sleeping area of the attic',
 'reckless : the car was reported as stolen before the driver took police on the unforgettable chase across much .',
 'moss on a rock by the stream',
 'rugby player during the match .',
 'person and actor attend the premiere .',
 'young girl walking on the dry grass field under daylight',
 'the water stream flowing from a man - made waterfall',
 'fans interferes with # on a ball hit by # of sports team scoring runs in the eighth inning during game',
 'a business woman writes notes down and works on a laptop computer',
 'construction crews work on the pagoda - style temple on monday .',
 'orange lily in the garden',
 'singer attends the unveiling of the wax figure',
 'the color of cooked poultry is not a sure sign of its safety .',
 'person ripping it through the golden grass',
 'biological species , or biological species , with a calf walks near tourists .',
 'person as she arrived following her restoration , ready for her launch',
 'illustration by painting artist -- sit side by side in a basket , surrounded by random objects they have',
 'tourist attraction connecting island will soon be replaced with a new parallel bridge .',
 'acoustic artist performs live in support of folk rock artist on stage during a concert .',
 'global map showing plastic density in the oceans , with overlay showing what countries likely contribute the most .',
 'studio portrait of smiley russian little girls wearing traditional costume isolated over white background / image of young beautiful girls in national dress on a white background',
 'author with his large format camera in the swamp',
 'instrumental rock artist and band performing live .',
 'silhouettes of young couple dancing on the roof on sunset .',
 'the team relaxes during halftime of their senior game .',
 '3d man reading a book .',
 'an exposure of the building located after dark .',
 'footage in high definition of a frustrated young businessman working with a laptop in office',
 'heavens golden gates opening to an ethereal light on a cloudy background',
 'actor attends the premiere of film .',
 'boat tour through the swamp',
 'vector silhouette of couple who argue against a white background .',
 'singer and person attends the premiere of thriller film .',
 'actor arrives for the premiere',
 'one of chefs takes the order of a customer .',
 'matching shoes star was already a grandfather of girls - by person and his wife',
 'photo of click the thumbnail to enlarge .',
 'white swan on the blue background',
 "simple outline drawing of a men 's blank t - shirt and tee -- stock photo #",
 'type of dish from the80s',
 'what i aspire to be - an older woman with her own style',
 'type of place of worship in person',
 'just one of many castles',
 'young man exercising his biceps in the gym',
 'several people gather for a rally and march .',
 'jockey gets a kiss from person after winning the 143rd running .',
 'a rat is watched by his handler at a laboratory',
 'pouring hot coffee in a traditional cup on a wooden table',
 'photo taken by the accidental bakers by person',
 'coloured buildings in the city',
 'image may contain : person , on stage and playing a musical instrument',
 'comedian attends the 8th opening night party',
 'ducks swimming in the river',
 'the cut out detail adds to the modernity of this wedding dress .',
 'my drawing from a pic i found on the net',
 'the much - anticipated collaboration was unveiled in front of a star - studded crowd .',
 'old stone bridge under the stars',
 'a group of ethnicity paddle their canoe',
 "the family 's home went up in smoke on saturday afternoon .",
 'person answering the phones again at the office .',
 'the storms in your eyes',
 'image may contain : person , on stage , playing a musical instrument , guitar , concert and indoor',
 'illustration of a religious practice arguing',
 'actor arrives at the premiere',
 'young girl with small pig on a leash and dog behind her in the middle of a dirt',
 'on prom night , every detail matters .',
 'a city on the municipalities map',
 'steering wheel on a white',
 'the tower rising above the tree - lined street - exterior photo',
 'letter logo design in a circle .',
 'a model walks the runway at the fashion show during fashion week .',
 'small piece of turf , a work by person made of inks and oils on paper .',
 'metallic paint silver letter a lowercase .',
 'image may contain : person , on stage and playing a musical instrument',
 'do these earrings possess power for their wearer ?',
 'teenage girl reading on a tablet',
 'add them to the boiling water one at a time to make sure they do not stick together .',
 'a city on what to see and where to stay when visiting administrative division',
 'person needs a set of cufflinks to match his suit and tie',
 'person explains how to shoot fruit or vegetables on a white background',
 'celebrity and politician are reportedly moving to person -- the same neighborhood where the family will live when they vacate the white house .',
 'open door to the sky',
 'the tank personally knocked out by person .',
 'images at boys basketball game .',
 'time lapse of business people inside a modern office building',
 'a natural history of birds',
 'a fire burns at a hotel .',
 'getting married in the city of play at the hotel',
 'actor from models off - duty style model walks the streets in her everyday uniform : a crop top , distressed jeans and oversize coat .',
 'a gardener may water the plant daily but fruits grow only in the season .',
 'a family of swans on the lake',
 'a soaking tub is the centerpiece of the master bathroom',
 'canadian census division fresh flowers on sale',
 'vector illustration of a background for holiday with ribbon .',
 'the black cloud on a gray background',
 'a lone pomegranate hangs adding color to subdued winter garden',
 'person looked stunning in a midnight blue evening gown , which she teamed with her engagement ring',
 'vector illustration of a banner for holiday .',
 'a view of bank notes of the currency meant for payment',
 "colorful children 's seamless pattern in cartoon style with the image of the rabbit and the little rabbits",
 'the trail leads into the fog .',
 'thank you person for such a beautiful birthday cake !',
 'hand holding and raising the national flag',
 '$9,725 a prong - set carat round center diamond dominates this platinum engagement ring with round diamonds on the sides .',
 'person and his longtime partner at a premiere .',
 'chalk painted piano -- i would never do this to my piano , but i do love how it turned out !',
 'love with a side of trousers .',
 'life : person wore ultra short denim shorts in the upmarket district , while chord carried a camera round his neck',
 'euro banknote on a white background',
 'fashion of the 1900s more',
 'filming location where to shop , eat and party !',
 'soccer player speaks during a press conference .',
 'take an exclusive tour of person and home during the holidays as each room gets a sparkling transformation .',
 'like magic , the sun shone brightly this afternoon , bringing guests out on the pool deck once again .',
 'players celebrate from an open - top bus',
 'illustration of a woman with angry face',
 'ripe mango on a plate .',
 ...]</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Dataset({
    features: ['image_url', 'caption'],
    num_rows: 3318333
})</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>ds <span class="op">=</span> ds.train_test_split(test_size<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>train_ds <span class="op">=</span> ds[<span class="st">"train"</span>]</span>
<span id="cb11-3"><a href="#cb11-3"></a>test_ds <span class="op">=</span> ds[<span class="st">"test"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s visualize a couple of samples from the training set.</p>
<div id="cell-12" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>train_ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>{'image_url': 'http://l7.alamy.com/zooms/a95a95341dcb4ebd810d5a30503bb98a/fisherman-sell-seafood-at-the-fish-market-fg4p25.jpg',
 'caption': 'sell seafood at the fish market'}</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> textwrap <span class="im">import</span> wrap</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="kw">def</span> plot_images(images, captions):</span>
<span id="cb14-7"><a href="#cb14-7"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(images)):</span>
<span id="cb14-9"><a href="#cb14-9"></a>        ax <span class="op">=</span> plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(images), i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a>        caption <span class="op">=</span> captions[i]</span>
<span id="cb14-11"><a href="#cb14-11"></a>        caption <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(wrap(caption, <span class="dv">12</span>))</span>
<span id="cb14-12"><a href="#cb14-12"></a>        plt.title(caption)</span>
<span id="cb14-13"><a href="#cb14-13"></a>        plt.imshow(images[i])</span>
<span id="cb14-14"><a href="#cb14-14"></a>        plt.axis(<span class="st">"off"</span>)</span>
<span id="cb14-15"><a href="#cb14-15"></a></span>
<span id="cb14-16"><a href="#cb14-16"></a></span>
<span id="cb14-17"><a href="#cb14-17"></a>sample_images_to_visualize <span class="op">=</span> [np.array(train_ds[i][<span class="st">"image"</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb14-18"><a href="#cb14-18"></a>sample_captions <span class="op">=</span> [train_ds[i][<span class="st">"text"</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>)]</span>
<span id="cb14-19"><a href="#cb14-19"></a>plot_images(sample_images_to_visualize, sample_captions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>KeyError: 'image'</code></pre>
</div>
</div>
<div class="flex justify-center">
<pre><code>&lt;img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/sample_training_images_image_cap.png" alt="Sample training images"/&gt;</code></pre>
</div>
</section>
<section id="preprocess-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="preprocess-the-dataset">Preprocess the dataset</h2>
<p>Since the dataset has two modalities (image and text), the pre-processing pipeline will preprocess images and the captions.</p>
<p>To do so, load the processor class associated with the model you are about to fine-tune.</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoProcessor</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>checkpoint <span class="op">=</span> <span class="st">"microsoft/git-base"</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>processor <span class="op">=</span> AutoProcessor.from_pretrained(checkpoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The processor will internally pre-process the image (which includes resizing, and pixel scaling) and tokenize the caption.</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">def</span> transforms(example_batch):</span>
<span id="cb18-2"><a href="#cb18-2"></a>    images <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> example_batch[<span class="st">"image"</span>]]</span>
<span id="cb18-3"><a href="#cb18-3"></a>    captions <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> example_batch[<span class="st">"text"</span>]]</span>
<span id="cb18-4"><a href="#cb18-4"></a>    inputs <span class="op">=</span> processor(images<span class="op">=</span>images, text<span class="op">=</span>captions, padding<span class="op">=</span><span class="st">"max_length"</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a>    inputs.update({<span class="st">"labels"</span>: inputs[<span class="st">"input_ids"</span>]})</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="cf">return</span> inputs</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a></span>
<span id="cb18-9"><a href="#cb18-9"></a>train_ds.set_transform(transforms)</span>
<span id="cb18-10"><a href="#cb18-10"></a>test_ds.set_transform(transforms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the dataset ready, you can now set up the model for fine-tuning.</p>
</section>
<section id="load-a-base-model" class="level2">
<h2 class="anchored" data-anchor-id="load-a-base-model">Load a base model</h2>
<p>Load the <a href="https://huggingface.co/microsoft/git-base">“microsoft/git-base”</a> into a <a href="https://huggingface.co/docs/transformers/model_doc/auto#transformers.AutoModelForCausalLM"><code>AutoModelForCausalLM</code></a> object.</p>
<div id="cell-23" class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoModelForCausalLM</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>model <span class="op">=</span> AutoModelForCausalLM.from_pretrained(checkpoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluate" class="level2">
<h2 class="anchored" data-anchor-id="evaluate">Evaluate</h2>
<p>Image captioning models are typically evaluated with the <a href="https://huggingface.co/spaces/evaluate-metric/rouge">Rouge Score</a> or <a href="https://huggingface.co/spaces/evaluate-metric/wer">Word Error Rate</a>. For this guide, you will use the Word Error Rate (WER).</p>
<p>We use the 🤗 Evaluate library to do so. For potential limitations and other gotchas of the WER, refer to <a href="https://huggingface.co/spaces/evaluate-metric/wer">this guide</a>.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="im">from</span> evaluate <span class="im">import</span> load</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="im">import</span> torch</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>wer <span class="op">=</span> load(<span class="st">"wer"</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="kw">def</span> compute_metrics(eval_pred):</span>
<span id="cb20-8"><a href="#cb20-8"></a>    logits, labels <span class="op">=</span> eval_pred</span>
<span id="cb20-9"><a href="#cb20-9"></a>    predicted <span class="op">=</span> logits.argmax(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-10"><a href="#cb20-10"></a>    decoded_labels <span class="op">=</span> processor.batch_decode(labels, skip_special_tokens<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-11"><a href="#cb20-11"></a>    decoded_predictions <span class="op">=</span> processor.batch_decode(predicted, skip_special_tokens<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb20-12"><a href="#cb20-12"></a>    wer_score <span class="op">=</span> wer.compute(predictions<span class="op">=</span>decoded_predictions, references<span class="op">=</span>decoded_labels)</span>
<span id="cb20-13"><a href="#cb20-13"></a>    <span class="cf">return</span> {<span class="st">"wer_score"</span>: wer_score}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="train" class="level2">
<h2 class="anchored" data-anchor-id="train">Train!</h2>
<p>Now, you are ready to start fine-tuning the model. You will use the 🤗 <a href="https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.Trainer">Trainer</a> for this.</p>
<p>First, define the training arguments using <a href="https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.TrainingArguments">TrainingArguments</a>.</p>
<div id="cell-29" class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">from</span> transformers <span class="im">import</span> TrainingArguments, Trainer</span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a>model_name <span class="op">=</span> checkpoint.split(<span class="st">"/"</span>)[<span class="dv">1</span>]</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a>training_args <span class="op">=</span> TrainingArguments(</span>
<span id="cb21-6"><a href="#cb21-6"></a>    output_dir<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">-pokemon"</span>,</span>
<span id="cb21-7"><a href="#cb21-7"></a>    learning_rate<span class="op">=</span><span class="fl">5e-5</span>,</span>
<span id="cb21-8"><a href="#cb21-8"></a>    num_train_epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb21-9"><a href="#cb21-9"></a>    fp16<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-10"><a href="#cb21-10"></a>    per_device_train_batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb21-11"><a href="#cb21-11"></a>    per_device_eval_batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb21-12"><a href="#cb21-12"></a>    gradient_accumulation_steps<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb21-13"><a href="#cb21-13"></a>    save_total_limit<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb21-14"><a href="#cb21-14"></a>    evaluation_strategy<span class="op">=</span><span class="st">"steps"</span>,</span>
<span id="cb21-15"><a href="#cb21-15"></a>    eval_steps<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb21-16"><a href="#cb21-16"></a>    save_strategy<span class="op">=</span><span class="st">"steps"</span>,</span>
<span id="cb21-17"><a href="#cb21-17"></a>    save_steps<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb21-18"><a href="#cb21-18"></a>    logging_steps<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb21-19"><a href="#cb21-19"></a>    remove_unused_columns<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb21-20"><a href="#cb21-20"></a>    push_to_hub<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-21"><a href="#cb21-21"></a>    label_names<span class="op">=</span>[<span class="st">"labels"</span>],</span>
<span id="cb21-22"><a href="#cb21-22"></a>    load_best_model_at_end<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-23"><a href="#cb21-23"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then pass them along with the datasets and the model to 🤗 Trainer.</p>
<div id="cell-31" class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>trainer <span class="op">=</span> Trainer(</span>
<span id="cb22-2"><a href="#cb22-2"></a>    model<span class="op">=</span>model,</span>
<span id="cb22-3"><a href="#cb22-3"></a>    args<span class="op">=</span>training_args,</span>
<span id="cb22-4"><a href="#cb22-4"></a>    train_dataset<span class="op">=</span>train_ds,</span>
<span id="cb22-5"><a href="#cb22-5"></a>    eval_dataset<span class="op">=</span>test_ds,</span>
<span id="cb22-6"><a href="#cb22-6"></a>    compute_metrics<span class="op">=</span>compute_metrics,</span>
<span id="cb22-7"><a href="#cb22-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To start training, simply call <a href="https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.Trainer.train">train()</a> on the <a href="https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.Trainer">Trainer</a> object.</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>trainer.train()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see the training loss drop smoothly as training progresses.</p>
<p>Once training is completed, share your model to the Hub with the <a href="https://huggingface.co/docs/transformers/main/en/main_classes/trainer#transformers.Trainer.push_to_hub">push_to_hub()</a> method so everyone can use your model:</p>
<div id="cell-35" class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>trainer.push_to_hub()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inference" class="level2">
<h2 class="anchored" data-anchor-id="inference">Inference</h2>
<p>Take a sample image from <code>test_ds</code> to test the model.</p>
<div id="cell-38" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="im">import</span> requests</span>
<span id="cb25-3"><a href="#cb25-3"></a></span>
<span id="cb25-4"><a href="#cb25-4"></a>url <span class="op">=</span> <span class="st">"https://huggingface.co/datasets/sayakpaul/sample-datasets/resolve/main/pokemon.png"</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(requests.get(url, stream<span class="op">=</span><span class="va">True</span>).raw)</span>
<span id="cb25-6"><a href="#cb25-6"></a>image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="flex justify-center">
<pre><code>&lt;img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/test_image_image_cap.png" alt="Test image"/&gt;</code></pre>
</div>
<p>Prepare image for the model.</p>
<div id="cell-40" class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>device <span class="op">=</span> <span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a>inputs <span class="op">=</span> processor(images<span class="op">=</span>image, return_tensors<span class="op">=</span><span class="st">"pt"</span>).to(device)</span>
<span id="cb27-4"><a href="#cb27-4"></a>pixel_values <span class="op">=</span> inputs.pixel_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Call <code>generate</code> and decode the predictions.</p>
<div id="cell-42" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>generated_ids <span class="op">=</span> model.generate(pixel_values<span class="op">=</span>pixel_values, max_length<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a>generated_caption <span class="op">=</span> processor.batch_decode(generated_ids, skip_special_tokens<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="bu">print</span>(generated_caption)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1"></a><span class="ex">a</span> drawing of a pink and blue pokemon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Looks like the fine-tuned model generated a pretty good caption!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="miruetoto/yechan3" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>