<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="신록예찬">
<meta name="dcterms.date" content="2023-02-10">

<title>신록예찬’s Blog - Chap7: Text Analytics and Natural Language Processing using Graphs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">신록예찬’s Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DL2022/">
 <span class="menu-text">DL2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DV2022/">
 <span class="menu-text">DV2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/IP2022/">
 <span class="menu-text">IP2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/SC2022/">
 <span class="menu-text">SC2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DS2022/">
 <span class="menu-text">DS2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/IR2021/">
 <span class="menu-text">IR2021</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan/">
 <span class="menu-text">yechan</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan2/">
 <span class="menu-text">yechan2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/miruetoto/yechan3"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Chap7: Text Analytics and Natural Language Processing using Graphs</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block">Chap7: Text Analytics and Natural Language Processing using Graphs</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>신록예찬 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 10, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../1_essays.html" class="sidebar-item-text sidebar-link">Essays</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Let’s Study</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_cgsp.html" class="sidebar-item-text sidebar-link">CGSP</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_gml.html" class="sidebar-item-text sidebar-link">GML</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_python.html" class="sidebar-item-text sidebar-link">Python</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_pl.html" class="sidebar-item-text sidebar-link">PyTorch Lightning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_reviews.html" class="sidebar-item-text sidebar-link">Reviews</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../2_notes.html" class="sidebar-item-text sidebar-link">Notes</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Researches</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../3_hst.html" class="sidebar-item-text sidebar-link">HST</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../3_stgcn.html" class="sidebar-item-text sidebar-link">STGCN</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#text-analytics-and-natural-language-processing-using-graphs" id="toc-text-analytics-and-natural-language-processing-using-graphs" class="nav-link active" data-scroll-target="#text-analytics-and-natural-language-processing-using-graphs">Text Analytics and Natural Language Processing using Graphs</a>
  <ul class="collapse">
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset">Load Dataset</a></li>
  <li><a href="#language-detection" id="toc-language-detection" class="nav-link" data-scroll-target="#language-detection">Language Detection</a></li>
  <li><a href="#nlp-enrichment" id="toc-nlp-enrichment" class="nav-link" data-scroll-target="#nlp-enrichment">NLP Enrichment</a></li>
  <li><a href="#graph-generation" id="toc-graph-generation" class="nav-link" data-scroll-target="#graph-generation">Graph Generation</a>
  <ul class="collapse">
  <li><a href="#knowledge-base" id="toc-knowledge-base" class="nav-link" data-scroll-target="#knowledge-base">Knowledge base</a></li>
  </ul></li>
  <li><a href="#bipartite-graph" id="toc-bipartite-graph" class="nav-link" data-scroll-target="#bipartite-graph">Bipartite Graph</a>
  <ul class="collapse">
  <li><a href="#document-document-graph-projection" id="toc-document-document-graph-projection" class="nav-link" data-scroll-target="#document-document-graph-projection">Document-Document Graph Projection</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#to-be-visualized-in-gephi" id="toc-to-be-visualized-in-gephi" class="nav-link" data-scroll-target="#to-be-visualized-in-gephi">To be visualized in Gephi</a></li>
  <li><a href="#to-be-visualized-in-gephi-1" id="toc-to-be-visualized-in-gephi-1" class="nav-link" data-scroll-target="#to-be-visualized-in-gephi-1">To be visualized in Gephi</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="text-analytics-and-natural-language-processing-using-graphs" class="level1">
<h1>Text Analytics and Natural Language Processing using Graphs</h1>
<p>In the following we will focus on analyzing textual documents and leverage on graph analysis in order to identify insight and extract relevant information.</p>
<p>In particular in the following we will show you how to:</p>
<ul>
<li>Extract structured information from text by using NLP techniques and models</li>
<li>Build different type of graphs starting from the information extracted in the previous point</li>
<li>Analyze the graph</li>
</ul>
<section id="load-dataset" class="level3">
<h3 class="anchored" data-anchor-id="load-dataset">Load Dataset</h3>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> nltk </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> reuters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>corpus <span class="op">=</span> pd.DataFrame([</span>
<span id="cb5-2"><a href="#cb5-2"></a>    {<span class="st">"id"</span>: _id, <span class="st">"clean_text"</span>: reuters.raw(_id).replace(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">""</span>), <span class="st">"label"</span>: reuters.categories(_id)}</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="cf">for</span> _id <span class="kw">in</span> reuters.fileids()</span>
<span id="cb5-4"><a href="#cb5-4"></a>]).set_index(<span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>corpus.iloc[<span class="dv">10</span>][<span class="st">"clean_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>'SUBROTO SAYS INDONESIA SUPPORTS TIN PACT EXTENSION  Mines and Energy Minister Subroto  confirmed Indonesian support for an extension of the sixth  International Tin Agreement (ITA), but said a new pact was not  necessary.      Asked by Reuters to clarify his statement on Monday in  which he said the pact should be allowed to lapse, Subroto said  Indonesia was ready to back extension of the ITA.      "We can support extension of the sixth agreement," he said.  "But a seventh accord we believe to be unnecessary."      The sixth ITA will expire at the end of June unless a  two-thirds majority of members vote for an extension.  '</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="bu">len</span>(Counter([label <span class="cf">for</span> document_labels <span class="kw">in</span> corpus[<span class="st">"label"</span>] <span class="cf">for</span> label <span class="kw">in</span> document_labels]).most_common())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>90</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>corpus.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="language-detection" class="level3">
<h3 class="anchored" data-anchor-id="language-detection">Language Detection</h3>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> langdetect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">def</span> getLanguage(text: <span class="bu">str</span>):</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="cf">try</span>:</span>
<span id="cb12-5"><a href="#cb12-5"></a>        <span class="cf">return</span> langdetect.detect(text)</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="cf">except</span>: </span>
<span id="cb12-7"><a href="#cb12-7"></a>        <span class="cf">return</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>corpus[<span class="st">"language"</span>] <span class="op">=</span> corpus[<span class="st">"clean_text"</span>].<span class="bu">apply</span>(getLanguage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>corpus[<span class="st">"language"</span>].value_counts().head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>en    9899
sv     432
de     371
sw      29
so      23
pt       7
nl       7
vi       6
et       5
ca       2
Name: language, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>corpus.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
      <th>language</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
      <td>en</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
      <td>en</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
      <td>en</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
      <td>en</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
      <td>en</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Using fasttext</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">!</span>curl <span class="op">-</span>w GET https:<span class="op">//</span>dl.fbaipublicfiles.com<span class="op">/</span>fasttext<span class="op">/</span>supervised<span class="op">-</span>models<span class="op">/</span>lid<span class="fl">.176</span>.ftz <span class="op">&gt;</span> lid<span class="fl">.176</span>.ftz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  916k  100  916k    0     0   547k      0  0:00:01  0:00:01 --:--:--  548k</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="im">import</span> fasttext</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>m <span class="op">=</span> fasttext.load_model(<span class="st">"lid.176.ftz"</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="kw">def</span> getLanguage(text: <span class="bu">str</span>):</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="cf">return</span> m.predict(text)[<span class="dv">0</span>][<span class="dv">0</span>].replace(<span class="st">"__label__"</span>, <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning : `load_model` does not return WordVectorModel or SupervisedModel any more, but a `FastText` object which is very similar.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>corpus[<span class="st">"language"</span>] <span class="op">=</span> corpus[<span class="st">"clean_text"</span>].<span class="bu">apply</span>(getLanguage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>corpus[<span class="st">"language"</span>].value_counts().head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>en    10278
de       90
ja       73
it       67
sv       52
zh       48
es       31
fr       27
eu       20
eo       12
Name: language, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>corpus[corpus[<span class="st">"language"</span>]<span class="op">==</span><span class="st">"ja"</span>].iloc[<span class="dv">5</span>][<span class="st">"clean_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>'USDA - U.S. 1986/87 ENDING CORN STOCKS  5,240 MLN BU, WHEAT 1,848 MLN, SOYBEANS 610 MLN  USDA - U.S. 1986/87 ENDING CORN STOCKS  5,240 MLN BU, WHEAT 1,848 MLN, SOYBEANS 610 MLN  '</code></pre>
</div>
</div>
</section>
<section id="nlp-enrichment" class="level3">
<h3 class="anchored" data-anchor-id="nlp-enrichment">NLP Enrichment</h3>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="im">import</span> spacy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to download the model from the Spacy library, please issue the following command in a shell</p>
<pre><code>
python -m spacy download en_core_web_md
</code></pre>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>nlp <span class="op">=</span> spacy.load(<span class="st">'en_core_web_md'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>corpus[<span class="st">"parsed"</span>] <span class="op">=</span> corpus[<span class="st">"clean_text"</span>].<span class="bu">apply</span>(nlp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>corpus.loc[<span class="st">"test/14832"</span>][<span class="st">"clean_text"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>"THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Thailand's trade deficit widened to 4.5  billion baht in the first quarter of 1987 from 2.1 billion a  year ago, the Business Economics Department said.      It said Janunary/March imports rose to 65.1 billion baht  from 58.7 billion. Thailand's improved business climate this  year resulted in a 27 pct increase in imports of raw materials  and semi-finished products.      The country's oil import bill, however, fell 23 pct in the  first quarter due to lower oil prices.      The department said first quarter exports expanded to 60.6  billion baht from 56.6 billion.      Export growth was smaller than expected due to lower  earnings from many key commodities including rice whose  earnings declined 18 pct, maize 66 pct, sugar 45 pct, tin 26  pct and canned pineapples seven pct.      Products registering high export growth were jewellery up  64 pct, clothing 57 pct and rubber 35 pct.  "</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="im">from</span> spacy <span class="im">import</span> displacy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>displacy.render(corpus.loc[<span class="st">"test/14832"</span>][<span class="st">"parsed"</span>], style<span class="op">=</span><span class="st">'ent'</span>, jupyter<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<span class="tex2jax_ignore"><div class="entities" style="line-height: 2.5; direction: ltr">THAI TRADE DEFICIT WIDENS IN 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    FIRST QUARTER
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
  
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Thailand
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
's trade deficit widened to 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    4.5  billion baht
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 in 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    the first quarter of 1987
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 from 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    2.1 billion
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 a  year ago, 
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    the Business Economics Department
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 said.      It said 
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Janunary
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
/March imports rose to 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    65.1 billion baht
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
  from 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    58.7 billion
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
. 
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    Thailand
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
's improved business climate 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    this  year
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 resulted in a 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    27 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 increase in imports of raw materials  and semi-finished products.      The country's oil import bill, however, fell 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    23 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 in 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    the  first quarter
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 due to lower oil prices.      The department said 
<mark class="entity" style="background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    first quarter
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">DATE</span>
</mark>
 exports expanded to 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    60.6  billion baht
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 from 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    56.6 billion
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
.      Export growth was smaller than expected due to lower  earnings from many key commodities including rice whose  earnings declined 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    18 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
, maize 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    66 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
, sugar 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    45 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
, tin 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    26  pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 and canned pineapples 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    seven pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
.      Products registering high export growth were jewellery up  64 pct, clothing 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    57 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
 and rubber 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;">
    35 pct
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
.  </div></span>
</div>
</div>
<section id="export-corpus-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="export-corpus-dataframe">Export corpus Dataframe</h4>
<div class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a>corpus.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="162">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
      <th>language</th>
      <th>parsed</th>
      <th>triplets</th>
      <th>keywords</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
      <td>en</td>
      <td>(ASIAN, EXPORTERS, FEAR, DAMAGE, FROM, U.S.-JA...</td>
      <td>[(EXPORTERS, (FEAR, False), DAMAGE), (Japan, (...</td>
      <td>[(trading, 0.461513063953854), (said, 0.315985...</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
      <td>en</td>
      <td>(CHINA, DAILY, SAYS, VERMIN, EAT, 7, -, 12, PC...</td>
      <td>[(VERMIN, (EAT, False), STOCKS), (vermin, (con...</td>
      <td>[(vermin, 0.3120614380287176), (daily, 0.26110...</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
      <td>en</td>
      <td>(JAPAN, TO, REVISE, LONG, -, TERM, ENERGY, DEM...</td>
      <td>[(JAPAN, (REVISE, False), DEMAND), (Industry, ...</td>
      <td>[(energy, 0.3857636092660117), (demand, 0.3479...</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
      <td>en</td>
      <td>(THAI, TRADE, DEFICIT, WIDENS, IN, FIRST, QUAR...</td>
      <td>[(Products, (registering, False), growth), (Pr...</td>
      <td>[(pct, 0.5457455609144312), (export, 0.2656069...</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
      <td>en</td>
      <td>(INDONESIA, SEES, CPO, PRICE, RISING, SHARPLY,...</td>
      <td>[(INDONESIA, (SEES, False), PRICE), (Indonesia...</td>
      <td>[(indonesia, 0.2410428235502938), (harahap, 0....</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>corpus[[<span class="st">"clean_text"</span>, <span class="st">"label"</span>, <span class="st">"language"</span>, <span class="st">"parsed"</span>]].to_pickle(<span class="st">"corpus.p"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="graph-generation" class="level2">
<h2 class="anchored" data-anchor-id="graph-generation">Graph Generation</h2>
<p>In the following, we will show you how to create two different kind of graphs out of a corpus of documents:</p>
<ul>
<li>Knowledge base graphs, where the subject-verb-object relation will be encoded to build a semantic graph</li>
<li>Bipartite graphs, linking documents with the entities/keywords appearing therein</li>
</ul>
<section id="knowledge-base" class="level3">
<h3 class="anchored" data-anchor-id="knowledge-base">Knowledge base</h3>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="im">from</span> subject_object_extraction <span class="im">import</span> findSVOs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>corpus[<span class="st">"triplets"</span>] <span class="op">=</span> corpus[<span class="st">"parsed"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: findSVOs(x, output<span class="op">=</span><span class="st">"obj"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>corpus.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
      <th>language</th>
      <th>parsed</th>
      <th>triplets</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
      <td>en</td>
      <td>(ASIAN, EXPORTERS, FEAR, DAMAGE, FROM, U.S.-JA...</td>
      <td>[(EXPORTERS, (FEAR, False), DAMAGE), (Japan, (...</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
      <td>en</td>
      <td>(CHINA, DAILY, SAYS, VERMIN, EAT, 7, -, 12, PC...</td>
      <td>[(VERMIN, (EAT, False), STOCKS), (vermin, (con...</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
      <td>en</td>
      <td>(JAPAN, TO, REVISE, LONG, -, TERM, ENERGY, DEM...</td>
      <td>[(JAPAN, (REVISE, False), DEMAND), (Industry, ...</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
      <td>en</td>
      <td>(THAI, TRADE, DEFICIT, WIDENS, IN, FIRST, QUAR...</td>
      <td>[(Products, (registering, False), growth), (Pr...</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
      <td>en</td>
      <td>(INDONESIA, SEES, CPO, PRICE, RISING, SHARPLY,...</td>
      <td>[(INDONESIA, (SEES, False), PRICE), (Indonesia...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>edge_list <span class="op">=</span> [</span>
<span id="cb38-2"><a href="#cb38-2"></a>    {<span class="st">"id"</span>: _id, <span class="st">"source"</span>: source.lemma_.lower(), <span class="st">"target"</span>: target.lemma_.lower(), <span class="st">"edge"</span>: edge.lemma_.lower()}</span>
<span id="cb38-3"><a href="#cb38-3"></a>    <span class="cf">for</span> _id, triplets <span class="kw">in</span> corpus[<span class="st">"triplets"</span>].iteritems()</span>
<span id="cb38-4"><a href="#cb38-4"></a>    <span class="cf">for</span> (source, (edge, neg), target) <span class="kw">in</span> triplets</span>
<span id="cb38-5"><a href="#cb38-5"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>edges <span class="op">=</span> pd.DataFrame(edge_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>edges[<span class="st">"edge"</span>].value_counts().head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>be         7620
have       2675
include    2010
tell       1729
buy        1464
sell       1385
say        1216
take       1172
make       1151
give       1029
Name: edge, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a>G<span class="op">=</span>nx.from_pandas_edgelist(edges, <span class="st">"source"</span>, <span class="st">"target"</span>, </span>
<span id="cb43-2"><a href="#cb43-2"></a>                          edge_attr<span class="op">=</span><span class="va">True</span>, create_using<span class="op">=</span>nx.MultiDiGraph())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="bu">len</span>(G.nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>7576</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">def</span> plotDistribution(serie: pd.Series, nbins: <span class="bu">int</span>, minValue<span class="op">=</span><span class="va">None</span>, maxValue<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb46-2"><a href="#cb46-2"></a>    _minValue<span class="op">=</span><span class="bu">int</span>(np.floor(np.log10(minValue <span class="cf">if</span> minValue <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> serie.<span class="bu">min</span>())))</span>
<span id="cb46-3"><a href="#cb46-3"></a>    _maxValue<span class="op">=</span><span class="bu">int</span>(np.ceil(np.log10(maxValue <span class="cf">if</span> maxValue <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> serie.<span class="bu">max</span>())))</span>
<span id="cb46-4"><a href="#cb46-4"></a>    bins <span class="op">=</span> [<span class="dv">0</span>] <span class="op">+</span> <span class="bu">list</span>(np.logspace(_minValue, _maxValue, nbins)) <span class="op">+</span> [np.inf]</span>
<span id="cb46-5"><a href="#cb46-5"></a>    serie.hist(bins<span class="op">=</span>bins)</span>
<span id="cb46-6"><a href="#cb46-6"></a>    plt.xscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw">def</span> graphSummary(graph, bins<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb47-2"><a href="#cb47-2"></a>    <span class="bu">print</span>(nx.info(graph))</span>
<span id="cb47-3"><a href="#cb47-3"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb47-4"><a href="#cb47-4"></a>    plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb47-5"><a href="#cb47-5"></a>    degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(graph)})</span>
<span id="cb47-6"><a href="#cb47-6"></a>    plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb47-7"><a href="#cb47-7"></a>    plotDistribution(degrees, bins)</span>
<span id="cb47-8"><a href="#cb47-8"></a>    <span class="cf">try</span>:</span>
<span id="cb47-9"><a href="#cb47-9"></a>        plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb47-10"><a href="#cb47-10"></a>        allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> graph.edges(data<span class="op">=</span><span class="va">True</span>)})</span>
<span id="cb47-11"><a href="#cb47-11"></a>        plotDistribution(allEdgesWeights, bins)</span>
<span id="cb47-12"><a href="#cb47-12"></a>        plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb47-13"><a href="#cb47-13"></a>    <span class="cf">except</span>:</span>
<span id="cb47-14"><a href="#cb47-14"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="bu">print</span>(nx.info(G))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: MultiDiGraph
Number of nodes: 7576
Number of edges: 72263
Average in degree:   9.5384
Average out degree:   9.5384</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a>graphSummary(G, bins<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: MultiDiGraph
Number of nodes: 7576
Number of edges: 72263
Average in degree:   9.5384
Average out degree:   9.5384</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-40-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb53-2"><a href="#cb53-2"></a>np.log10(pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(G)}).sort_values(ascending<span class="op">=</span><span class="va">False</span>)).hist()</span>
<span id="cb53-3"><a href="#cb53-3"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Analysis of a certain relation</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a>edges.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>id</th>
      <th>source</th>
      <th>target</th>
      <th>edge</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>test/14826</td>
      <td>exporter</td>
      <td>damage</td>
      <td>fear</td>
    </tr>
    <tr>
      <th>1</th>
      <td>test/14826</td>
      <td>japan</td>
      <td>fear</td>
      <td>raise</td>
    </tr>
    <tr>
      <th>2</th>
      <td>test/14826</td>
      <td>row</td>
      <td>damage</td>
      <td>inflict</td>
    </tr>
    <tr>
      <th>3</th>
      <td>test/14826</td>
      <td>they</td>
      <td>correspondent</td>
      <td>tell</td>
    </tr>
    <tr>
      <th>4</th>
      <td>test/14826</td>
      <td>they</td>
      <td>u.s.</td>
      <td>tell</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>e <span class="op">=</span> edges[(edges[<span class="st">"source"</span>]<span class="op">!=</span><span class="st">" "</span>) <span class="op">&amp;</span> (edges[<span class="st">"target"</span>]<span class="op">!=</span><span class="st">" "</span>) <span class="op">&amp;</span> (edges[<span class="st">"edge"</span>]<span class="op">==</span><span class="st">"lend"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>G<span class="op">=</span>nx.from_pandas_edgelist(e, <span class="st">"source"</span>, <span class="st">"target"</span>, </span>
<span id="cb56-2"><a href="#cb56-2"></a>                          edge_attr<span class="op">=</span><span class="va">True</span>, create_using<span class="op">=</span>nx.MultiDiGraph())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="im">import</span> os</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">6</span>))</span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a>pos <span class="op">=</span> nx.spring_layout(G, k<span class="op">=</span><span class="fl">1.2</span>) <span class="co"># k regulates the distance between nodes</span></span>
<span id="cb57-6"><a href="#cb57-6"></a></span>
<span id="cb57-7"><a href="#cb57-7"></a>nx.draw(G, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'skyblue'</span>, node_size<span class="op">=</span><span class="dv">1500</span>, edge_cmap<span class="op">=</span>plt.cm.Blues, pos <span class="op">=</span> pos, font_size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb57-8"><a href="#cb57-8"></a></span>
<span id="cb57-9"><a href="#cb57-9"></a><span class="co"># plt.show()</span></span>
<span id="cb57-10"><a href="#cb57-10"></a><span class="co"># plt.savefig(os.path.join(".", "KnowledgeGraph.png"), dpi=300, format="png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="bipartite-graph" class="level2">
<h2 class="anchored" data-anchor-id="bipartite-graph">Bipartite Graph</h2>
<p>Let’s start by extracting the keywords from the documents</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1"></a><span class="im">import</span> gensim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="im">from</span> gensim.summarization <span class="im">import</span> keywords </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>text <span class="op">=</span> corpus[<span class="st">"clean_text"</span>][<span class="dv">0</span>]</span>
<span id="cb60-2"><a href="#cb60-2"></a>keywords(text, words<span class="op">=</span><span class="dv">10</span>, split<span class="op">=</span><span class="va">True</span>, scores<span class="op">=</span><span class="va">True</span>, pos_filter<span class="op">=</span>(<span class="st">'NN'</span>, <span class="st">'JJ'</span>), lemmatize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>[('trading', 0.4615130639538529),
 ('said', 0.3159855693494515),
 ('export', 0.2691553824958079),
 ('import', 0.17462010006456888),
 ('japanese electronics', 0.1360932626379031),
 ('industry', 0.1286043740379779),
 ('minister', 0.12229815662000462),
 ('japan', 0.11434500812642447),
 ('year', 0.10483992409352465)]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>corpus[<span class="st">"keywords"</span>] <span class="op">=</span> corpus[<span class="st">"clean_text"</span>].<span class="bu">apply</span>(</span>
<span id="cb62-2"><a href="#cb62-2"></a>    <span class="kw">lambda</span> text: keywords(text, words<span class="op">=</span><span class="dv">10</span>, split<span class="op">=</span><span class="va">True</span>, scores<span class="op">=</span><span class="va">True</span>, pos_filter<span class="op">=</span>(<span class="st">'NN'</span>, <span class="st">'JJ'</span>), lemmatize<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-3"><a href="#cb62-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>corpus.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
      <th>language</th>
      <th>parsed</th>
      <th>triplets</th>
      <th>keywords</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
      <td>en</td>
      <td>(ASIAN, EXPORTERS, FEAR, DAMAGE, FROM, U.S.-JA...</td>
      <td>[(EXPORTERS, (FEAR, False), DAMAGE), (Japan, (...</td>
      <td>[(trading, 0.461513063953854), (said, 0.315985...</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
      <td>en</td>
      <td>(CHINA, DAILY, SAYS, VERMIN, EAT, 7, -, 12, PC...</td>
      <td>[(VERMIN, (EAT, False), STOCKS), (vermin, (con...</td>
      <td>[(vermin, 0.3120614380287176), (daily, 0.26110...</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
      <td>en</td>
      <td>(JAPAN, TO, REVISE, LONG, -, TERM, ENERGY, DEM...</td>
      <td>[(JAPAN, (REVISE, False), DEMAND), (Industry, ...</td>
      <td>[(energy, 0.3857636092660117), (demand, 0.3479...</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
      <td>en</td>
      <td>(THAI, TRADE, DEFICIT, WIDENS, IN, FIRST, QUAR...</td>
      <td>[(Products, (registering, False), growth), (Pr...</td>
      <td>[(pct, 0.5457455609144312), (export, 0.2656069...</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
      <td>en</td>
      <td>(INDONESIA, SEES, CPO, PRICE, RISING, SHARPLY,...</td>
      <td>[(INDONESIA, (SEES, False), PRICE), (Indonesia...</td>
      <td>[(indonesia, 0.2410428235502938), (harahap, 0....</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">def</span> extractEntities(ents, minValue<span class="op">=</span><span class="dv">1</span>, typeFilters<span class="op">=</span>[<span class="st">"GPE"</span>, <span class="st">"ORG"</span>, <span class="st">"PERSON"</span>]):</span>
<span id="cb64-2"><a href="#cb64-2"></a>    entities <span class="op">=</span> pd.DataFrame([</span>
<span id="cb64-3"><a href="#cb64-3"></a>        {<span class="st">"lemma"</span>: e.lemma_, <span class="st">"lower"</span>: e.lemma_.lower(), <span class="st">"type"</span>: e.label_}</span>
<span id="cb64-4"><a href="#cb64-4"></a>        <span class="cf">for</span> e <span class="kw">in</span> ents <span class="cf">if</span> <span class="bu">hasattr</span>(e, <span class="st">"label_"</span>)</span>
<span id="cb64-5"><a href="#cb64-5"></a>    ])</span>
<span id="cb64-6"><a href="#cb64-6"></a></span>
<span id="cb64-7"><a href="#cb64-7"></a>    <span class="cf">if</span> <span class="bu">len</span>(entities)<span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb64-8"><a href="#cb64-8"></a>        <span class="cf">return</span> pd.DataFrame()</span>
<span id="cb64-9"><a href="#cb64-9"></a>    </span>
<span id="cb64-10"><a href="#cb64-10"></a>    g <span class="op">=</span> entities.groupby([<span class="st">"type"</span>, <span class="st">"lower"</span>])</span>
<span id="cb64-11"><a href="#cb64-11"></a></span>
<span id="cb64-12"><a href="#cb64-12"></a>    summary <span class="op">=</span> pd.concat({</span>
<span id="cb64-13"><a href="#cb64-13"></a>        <span class="st">"alias"</span>: g.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="st">"lemma"</span>].unique()), </span>
<span id="cb64-14"><a href="#cb64-14"></a>        <span class="st">"count"</span>: g[<span class="st">"lower"</span>].count()</span>
<span id="cb64-15"><a href="#cb64-15"></a>    }, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb64-16"><a href="#cb64-16"></a>    </span>
<span id="cb64-17"><a href="#cb64-17"></a>    <span class="cf">return</span> summary[summary[<span class="st">"count"</span>]<span class="op">&gt;</span><span class="dv">1</span>].loc[pd.IndexSlice[typeFilters, :, :]]</span>
<span id="cb64-18"><a href="#cb64-18"></a></span>
<span id="cb64-19"><a href="#cb64-19"></a><span class="kw">def</span> getOrEmpty(parsed, _type):</span>
<span id="cb64-20"><a href="#cb64-20"></a>    <span class="cf">try</span>:</span>
<span id="cb64-21"><a href="#cb64-21"></a>        <span class="cf">return</span> <span class="bu">list</span>(parsed.loc[_type][<span class="st">"count"</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).to_dict().items())</span>
<span id="cb64-22"><a href="#cb64-22"></a>    <span class="cf">except</span>:</span>
<span id="cb64-23"><a href="#cb64-23"></a>        <span class="cf">return</span> []</span>
<span id="cb64-24"><a href="#cb64-24"></a></span>
<span id="cb64-25"><a href="#cb64-25"></a><span class="kw">def</span> toField(ents):</span>
<span id="cb64-26"><a href="#cb64-26"></a>    typeFilters<span class="op">=</span>[<span class="st">"GPE"</span>, <span class="st">"ORG"</span>, <span class="st">"PERSON"</span>]</span>
<span id="cb64-27"><a href="#cb64-27"></a>    parsed <span class="op">=</span> extractEntities(ents, <span class="dv">1</span>, typeFilters)</span>
<span id="cb64-28"><a href="#cb64-28"></a>    <span class="cf">return</span> pd.Series({_type: getOrEmpty(parsed, _type) <span class="cf">for</span> _type <span class="kw">in</span> typeFilters})</span>
<span id="cb64-29"><a href="#cb64-29"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>entities <span class="op">=</span> corpus[<span class="st">"parsed"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: toField(x.ents))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>merged <span class="op">=</span> pd.concat([corpus, entities], axis<span class="op">=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>merged.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>clean_text</th>
      <th>label</th>
      <th>language</th>
      <th>parsed</th>
      <th>triplets</th>
      <th>keywords</th>
      <th>GPE</th>
      <th>ORG</th>
      <th>PERSON</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/14826</th>
      <td>ASIAN EXPORTERS FEAR DAMAGE FROM U.S.-JAPAN RI...</td>
      <td>[trade]</td>
      <td>en</td>
      <td>(ASIAN, EXPORTERS, FEAR, DAMAGE, FROM, U.S.-JA...</td>
      <td>[(EXPORTERS, (FEAR, False), DAMAGE), (Japan, (...</td>
      <td>[(trading, 0.461513063953854), (said, 0.315985...</td>
      <td>[(u.s., 13), (japan, 12), (taiwan, 3), (tokyo,...</td>
      <td>[]</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>test/14828</th>
      <td>CHINA DAILY SAYS VERMIN EAT 7-12 PCT GRAIN STO...</td>
      <td>[grain]</td>
      <td>en</td>
      <td>(CHINA, DAILY, SAYS, VERMIN, EAT, 7, -, 12, PC...</td>
      <td>[(VERMIN, (EAT, False), STOCKS), (vermin, (con...</td>
      <td>[(vermin, 0.3120614380287176), (daily, 0.26110...</td>
      <td>[(china, 2)]</td>
      <td>[]</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>test/14829</th>
      <td>JAPAN TO REVISE LONG-TERM ENERGY DEMAND DOWNWA...</td>
      <td>[crude, nat-gas]</td>
      <td>en</td>
      <td>(JAPAN, TO, REVISE, LONG, -, TERM, ENERGY, DEM...</td>
      <td>[(JAPAN, (REVISE, False), DEMAND), (Industry, ...</td>
      <td>[(energy, 0.3857636092660117), (demand, 0.3479...</td>
      <td>[(japan, 2)]</td>
      <td>[]</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>test/14832</th>
      <td>THAI TRADE DEFICIT WIDENS IN FIRST QUARTER  Th...</td>
      <td>[corn, grain, rice, rubber, sugar, tin, trade]</td>
      <td>en</td>
      <td>(THAI, TRADE, DEFICIT, WIDENS, IN, FIRST, QUAR...</td>
      <td>[(Products, (registering, False), growth), (Pr...</td>
      <td>[(pct, 0.5457455609144312), (export, 0.2656069...</td>
      <td>[(thailand, 2)]</td>
      <td>[]</td>
      <td>[]</td>
    </tr>
    <tr>
      <th>test/14833</th>
      <td>INDONESIA SEES CPO PRICE RISING SHARPLY  Indon...</td>
      <td>[palm-oil, veg-oil]</td>
      <td>en</td>
      <td>(INDONESIA, SEES, CPO, PRICE, RISING, SHARPLY,...</td>
      <td>[(INDONESIA, (SEES, False), PRICE), (Indonesia...</td>
      <td>[(indonesia, 0.2410428235502938), (harahap, 0....</td>
      <td>[(indonesia, 4), (malaysia, 2)]</td>
      <td>[(cpo, 2)]</td>
      <td>[]</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We finally create the bipartite graph</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>edges <span class="op">=</span> pd.DataFrame([</span>
<span id="cb68-2"><a href="#cb68-2"></a>    {<span class="st">"source"</span>: _id, <span class="st">"target"</span>: keyword, <span class="st">"weight"</span>: score, <span class="st">"type"</span>: _type}</span>
<span id="cb68-3"><a href="#cb68-3"></a>    <span class="cf">for</span> _id, row <span class="kw">in</span> merged.iterrows()</span>
<span id="cb68-4"><a href="#cb68-4"></a>    <span class="cf">for</span> _type <span class="kw">in</span> [<span class="st">"keywords"</span>, <span class="st">"GPE"</span>, <span class="st">"ORG"</span>, <span class="st">"PERSON"</span>] </span>
<span id="cb68-5"><a href="#cb68-5"></a>    <span class="cf">for</span> (keyword, score) <span class="kw">in</span> row[_type]</span>
<span id="cb68-6"><a href="#cb68-6"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="cb69-2"><a href="#cb69-2"></a>G.add_nodes_from(edges[<span class="st">"source"</span>].unique(), bipartite<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a>G.add_nodes_from(edges[<span class="st">"target"</span>].unique(), bipartite<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-4"><a href="#cb69-4"></a>G.add_edges_from([</span>
<span id="cb69-5"><a href="#cb69-5"></a>    (row[<span class="st">"source"</span>], row[<span class="st">"target"</span>])</span>
<span id="cb69-6"><a href="#cb69-6"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> edges.iterrows()</span>
<span id="cb69-7"><a href="#cb69-7"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>document_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> G.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>] <span class="op">==</span> <span class="dv">0</span>}</span>
<span id="cb70-2"><a href="#cb70-2"></a>entity_nodes <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> G.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>] <span class="op">==</span> <span class="dv">1</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a>nodes_with_low_degree <span class="op">=</span> {n <span class="cf">for</span> n, d <span class="kw">in</span> nx.degree(G, nbunch<span class="op">=</span>entity_nodes) <span class="cf">if</span> d<span class="op">&lt;</span><span class="dv">5</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="bu">print</span>(nx.info(G))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 25752
Number of edges: 100311
Average degree:   7.7905</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="im">from</span> networkx.algorithms.bipartite.projection <span class="im">import</span> overlap_weighted_projected_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>###&nbsp;Entity-Entity Graph Projection</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a>subGraph <span class="op">=</span> G.subgraph(<span class="bu">set</span>(G.nodes) <span class="op">-</span> nodes_with_low_degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>entityGraph <span class="op">=</span> overlap_weighted_projected_graph(</span>
<span id="cb76-2"><a href="#cb76-2"></a>    subGraph, </span>
<span id="cb76-3"><a href="#cb76-3"></a>    {n <span class="cf">for</span> n, d <span class="kw">in</span> subGraph.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>] <span class="op">==</span> <span class="dv">1</span>}</span>
<span id="cb76-4"><a href="#cb76-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="bu">len</span>(entityGraph.nodes())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>2386</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a>degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(entityGraph)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a>plotDistribution(degrees, <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-65-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a><span class="bu">print</span>(nx.info(entityGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 2386
Number of edges: 120198
Average degree: 100.7527</code></pre>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> entityGraph.edges(data<span class="op">=</span><span class="va">True</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>plotDistribution(allEdgesWeights, <span class="dv">100</span>)</span>
<span id="cb85-2"><a href="#cb85-2"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a>filteredEntityGraph <span class="op">=</span> entityGraph.edge_subgraph(</span>
<span id="cb86-2"><a href="#cb86-2"></a>    [edge <span class="cf">for</span> edge <span class="kw">in</span> entityGraph.edges <span class="cf">if</span> entityGraph.edges[edge][<span class="st">"weight"</span>]<span class="op">&gt;</span><span class="fl">0.05</span>]</span>
<span id="cb86-3"><a href="#cb86-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="bu">print</span>(nx.info(filteredEntityGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 2265
Number of edges: 8082
Average degree:   7.1364</code></pre>
</div>
</div>
<section id="local-and-global-properties-of-the-graph" class="level4">
<h4 class="anchored" data-anchor-id="local-and-global-properties-of-the-graph">Local and global properties of the graph</h4>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>globalKpis <span class="op">=</span> [{</span>
<span id="cb89-2"><a href="#cb89-2"></a>    <span class="st">"shortest_path"</span>: nx.average_shortest_path_length(_graph),</span>
<span id="cb89-3"><a href="#cb89-3"></a>    <span class="st">"clustering_coefficient"</span>: nx.average_clustering(_graph),</span>
<span id="cb89-4"><a href="#cb89-4"></a>    <span class="st">"global_efficiency"</span>: nx.global_efficiency(_graph)</span>
<span id="cb89-5"><a href="#cb89-5"></a>} <span class="cf">for</span> components <span class="kw">in</span> nx.connected_components(filteredEntityGraph) </span>
<span id="cb89-6"><a href="#cb89-6"></a>    <span class="cf">for</span> _graph <span class="kw">in</span> [nx.subgraph(filteredEntityGraph, components)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a>pd.concat([</span>
<span id="cb90-2"><a href="#cb90-2"></a>    pd.DataFrame(globalKpis), </span>
<span id="cb90-3"><a href="#cb90-3"></a>    pd.Series([<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> nx.connected_components(filteredEntityGraph)])</span>
<span id="cb90-4"><a href="#cb90-4"></a>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>shortest_path</th>
      <th>clustering_coefficient</th>
      <th>global_efficiency</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.715074</td>
      <td>0.211563</td>
      <td>0.227356</td>
      <td>2254</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.500000</td>
      <td>0.000000</td>
      <td>0.750000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.333333</td>
      <td>0.000000</td>
      <td>0.833333</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a>pd.Series([<span class="bu">len</span>(c) <span class="cf">for</span> c <span class="kw">in</span> nx.connected_components(filteredEntityGraph)]).<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>2265</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a>globalKpis[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>{'shortest_path': 4.715073779178782,
 'clustering_coefficient': 0.21156314975836948,
 'global_efficiency': 0.2273555107741054}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># nx.write_gexf(filteredEntityGraph, "filteredEntityGraph.gexf")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a>betweeness <span class="op">=</span> nx.betweenness_centrality(filteredEntityGraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a>_betweeness <span class="op">=</span> pd.Series(betweeness)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>plotDistribution(_betweeness[_betweeness<span class="op">&gt;</span><span class="dv">0</span>], <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-78-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>pageRanks <span class="op">=</span> pd.Series(nx.pagerank(filteredEntityGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a>degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(filteredEntityGraph)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a>kpis <span class="op">=</span> pd.concat({</span>
<span id="cb102-2"><a href="#cb102-2"></a>    <span class="st">"pageRank"</span>: pageRanks, </span>
<span id="cb102-3"><a href="#cb102-3"></a>    <span class="st">"degrees"</span>: degrees, </span>
<span id="cb102-4"><a href="#cb102-4"></a>    <span class="st">"betweeness"</span>: _betweeness</span>
<span id="cb102-5"><a href="#cb102-5"></a>}, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb103-2"><a href="#cb103-2"></a></span>
<span id="cb103-3"><a href="#cb103-3"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb103-4"><a href="#cb103-4"></a>plt.title(<span class="st">"Page rank vs degrees"</span>)</span>
<span id="cb103-5"><a href="#cb103-5"></a>plt.plot(kpis[<span class="st">"pageRank"</span>], kpis[<span class="st">"degrees"</span>], <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb103-6"><a href="#cb103-6"></a>plt.xlabel(<span class="st">"page rank"</span>)</span>
<span id="cb103-7"><a href="#cb103-7"></a>plt.ylabel(<span class="st">"degree"</span>)</span>
<span id="cb103-8"><a href="#cb103-8"></a>plt.xscale(<span class="st">"log"</span>)</span>
<span id="cb103-9"><a href="#cb103-9"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb103-10"><a href="#cb103-10"></a></span>
<span id="cb103-11"><a href="#cb103-11"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb103-12"><a href="#cb103-12"></a>plt.title(<span class="st">"Page rank vs betweeness"</span>)</span>
<span id="cb103-13"><a href="#cb103-13"></a>plt.plot(kpis[<span class="st">"pageRank"</span>], kpis[<span class="st">"betweeness"</span>], <span class="st">'.'</span>, color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb103-14"><a href="#cb103-14"></a>plt.xlabel(<span class="st">"page rank"</span>)</span>
<span id="cb103-15"><a href="#cb103-15"></a>plt.ylabel(<span class="st">"betweeness"</span>)</span>
<span id="cb103-16"><a href="#cb103-16"></a>plt.xscale(<span class="st">"log"</span>)</span>
<span id="cb103-17"><a href="#cb103-17"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb103-18"><a href="#cb103-18"></a>plt.ylim([<span class="fl">1E-5</span>, <span class="fl">2E-2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>(1e-05, 0.02)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-82-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb105-2"><a href="#cb105-2"></a>plt.plot(kpis[<span class="st">"pageRank"</span>], kpis[<span class="st">"betweeness"</span>], <span class="st">'b.'</span>)</span>
<span id="cb105-3"><a href="#cb105-3"></a>plt.xlabel(<span class="st">"page rank"</span>)</span>
<span id="cb105-4"><a href="#cb105-4"></a>plt.ylabel(<span class="st">"betweeness"</span>)</span>
<span id="cb105-5"><a href="#cb105-5"></a>plt.xscale(<span class="st">"log"</span>)</span>
<span id="cb105-6"><a href="#cb105-6"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb106-2"><a href="#cb106-2"></a></span>
<span id="cb106-3"><a href="#cb106-3"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb106-4"><a href="#cb106-4"></a>plotDistribution(degrees, <span class="dv">13</span>)</span>
<span id="cb106-5"><a href="#cb106-5"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb106-6"><a href="#cb106-6"></a>plt.title(<span class="st">"Degree Distribution"</span>)</span>
<span id="cb106-7"><a href="#cb106-7"></a></span>
<span id="cb106-8"><a href="#cb106-8"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb106-9"><a href="#cb106-9"></a>plotDistribution(allEdgesWeights, <span class="dv">20</span>)</span>
<span id="cb106-10"><a href="#cb106-10"></a>plt.xlim([<span class="fl">1E-2</span>, <span class="dv">10</span>])</span>
<span id="cb106-11"><a href="#cb106-11"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb106-12"><a href="#cb106-12"></a>plt.title(<span class="st">"Edge Weight Distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>Text(0.5, 1.0, 'Edge Weight Distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-84-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a>allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> filteredEntityGraph.edges(data<span class="op">=</span><span class="va">True</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>plotDistribution(allEdgesWeights, <span class="dv">20</span>)</span>
<span id="cb110-2"><a href="#cb110-2"></a>plt.xlim([<span class="fl">1E-2</span>, <span class="dv">10</span>])</span>
<span id="cb110-3"><a href="#cb110-3"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-86-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="visualization-of-the-network" class="level4">
<h4 class="anchored" data-anchor-id="visualization-of-the-network">Visualization of the Network</h4>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a><span class="co">#Create network layout for visualizations</span></span>
<span id="cb111-2"><a href="#cb111-2"></a>spring_pos <span class="op">=</span> nx.spring_layout(filteredEntityGraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>default_edge_color <span class="op">=</span> <span class="st">'gray'</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>default_node_color <span class="op">=</span> <span class="st">'#407cc9'</span></span>
<span id="cb112-3"><a href="#cb112-3"></a>enhanced_node_color <span class="op">=</span> <span class="st">'#f5b042'</span></span>
<span id="cb112-4"><a href="#cb112-4"></a>enhanced_edge_color <span class="op">=</span> <span class="st">'#cc2f04'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb113-2"><a href="#cb113-2"></a>nx.draw_networkx(filteredEntityGraph, pos<span class="op">=</span>spring_pos, node_color<span class="op">=</span>default_node_color, </span>
<span id="cb113-3"><a href="#cb113-3"></a>                 edge_color<span class="op">=</span>default_edge_color, with_labels<span class="op">=</span><span class="va">False</span>, node_size<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="community-detection" class="level4">
<h4 class="anchored" data-anchor-id="community-detection">Community detection</h4>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a><span class="im">import</span> community</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a>communities <span class="op">=</span> pd.Series(community.best_partition(filteredEntityGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a>communities.value_counts().sort_values(ascending<span class="op">=</span><span class="va">False</span>).plot(kind<span class="op">=</span><span class="st">"bar"</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb116-2"><a href="#cb116-2"></a>plt.xlabel(<span class="st">"Community"</span>)</span>
<span id="cb116-3"><a href="#cb116-3"></a>plt.ylabel(<span class="st">"# Members"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>Text(0, 0.5, '# Members')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-92-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a>communities.loc[<span class="st">"turkish"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>16</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>nodes <span class="op">=</span> communities[communities<span class="op">==</span><span class="dv">17</span>].index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a>nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>Index(['pharmaceutical', 'worth', 'american motors', 'parts', 'auditors',
       'qualified', 'midland', 'salomon', 'consolidated', 'taft', 'goldman',
       'rejects', 'plants', 'wednesday', 'tvx', 'miami', 'jersey', 'broadcast',
       'dudley taft', 'earn', 'audit', 'opinion', 'closing', 'directors',
       'liquidating', 'stations', 'controls', 'radio', 'chrysler',
       'statements', 'gets', 'motors', 'year ending', 'aluminum', 'beverage',
       'near', 'employs', 'renault', 'kentucky', 'bass', 'marine', 'semi',
       'staff', 'share payable', 'brand', 'adding', 'broadcasting', 'car',
       'financing', 'smelter', 'guinness', 'bidder', 'henderson', 'houston',
       'extended', 'david', 'amc', 'mitsui', 'toledo', 'alcan', 'importer',
       'institutional'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a>smallGrap <span class="op">=</span> nx.subgraph(filteredEntityGraph, nbunch<span class="op">=</span>nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb124-2"><a href="#cb124-2"></a></span>
<span id="cb124-3"><a href="#cb124-3"></a>pos <span class="op">=</span> nx.spring_layout(smallGrap) <span class="co"># k regulates the distance between nodes</span></span>
<span id="cb124-4"><a href="#cb124-4"></a></span>
<span id="cb124-5"><a href="#cb124-5"></a>nx.draw(smallGrap, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'skyblue'</span>, node_size<span class="op">=</span><span class="dv">1500</span>, edge_cmap<span class="op">=</span>plt.cm.Blues, pos <span class="op">=</span> pos)</span>
<span id="cb124-6"><a href="#cb124-6"></a></span>
<span id="cb124-7"><a href="#cb124-7"></a><span class="co"># plt.show()</span></span>
<span id="cb124-8"><a href="#cb124-8"></a><span class="co"># plt.savefig(os.path.join(".", "CloseUp.png"), dpi=300, format="png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-97-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Here we show a Bipartite Closeup of the cluster</p>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>bipartiteCloseup <span class="op">=</span> subGraph.edge_subgraph(</span>
<span id="cb125-2"><a href="#cb125-2"></a>    {e <span class="cf">for</span> e <span class="kw">in</span> subGraph.edges() <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(e).intersection(nodes))<span class="op">&gt;</span><span class="dv">0</span>}</span>
<span id="cb125-3"><a href="#cb125-3"></a>)</span>
<span id="cb125-4"><a href="#cb125-4"></a></span>
<span id="cb125-5"><a href="#cb125-5"></a>deg <span class="op">=</span> nx.degree(bipartiteCloseup)</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a>smallGrap <span class="op">=</span> nx.subgraph(bipartiteCloseup, {n <span class="cf">for</span> n, d <span class="kw">in</span> bipartiteCloseup.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>]<span class="op">==</span><span class="dv">1</span> <span class="kw">or</span> deg[n]<span class="op">&gt;</span><span class="dv">1</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1"></a><span class="bu">len</span>([n <span class="cf">for</span> n, d <span class="kw">in</span> bipartiteCloseup.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>]<span class="op">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<pre><code>480</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1"></a><span class="bu">len</span>(nodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>62</code></pre>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb130-2"><a href="#cb130-2"></a></span>
<span id="cb130-3"><a href="#cb130-3"></a>pos <span class="op">=</span> nx.kamada_kawai_layout(smallGrap) <span class="co"># k regulates the distance between nodes</span></span>
<span id="cb130-4"><a href="#cb130-4"></a></span>
<span id="cb130-5"><a href="#cb130-5"></a>node_color <span class="op">=</span> [<span class="st">"skyblue"</span> <span class="cf">if</span> d[<span class="st">"bipartite"</span>]<span class="op">==</span><span class="dv">1</span> <span class="cf">else</span> <span class="st">"red"</span> <span class="cf">for</span> n, d <span class="kw">in</span> smallGrap.nodes(data<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb130-6"><a href="#cb130-6"></a></span>
<span id="cb130-7"><a href="#cb130-7"></a>nx.draw(smallGrap, with_labels<span class="op">=</span><span class="va">False</span>, node_color<span class="op">=</span>node_color, <span class="co">#'skyblue', </span></span>
<span id="cb130-8"><a href="#cb130-8"></a>        node_size<span class="op">=</span><span class="dv">150</span>, edge_cmap<span class="op">=</span>plt.cm.Blues, pos <span class="op">=</span> pos)</span>
<span id="cb130-9"><a href="#cb130-9"></a></span>
<span id="cb130-10"><a href="#cb130-10"></a></span>
<span id="cb130-11"><a href="#cb130-11"></a><span class="co"># plt.show()</span></span>
<span id="cb130-12"><a href="#cb130-12"></a><span class="co"># plt.savefig(os.path.join(".", "BipartiteCloseUp.png"), dpi=300, format="png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-101-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="embeddings" class="level4">
<h4 class="anchored" data-anchor-id="embeddings">Embeddings</h4>
<p>Using TSNE</p>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a><span class="im">from</span> node2vec <span class="im">import</span> Node2Vec</span>
<span id="cb131-2"><a href="#cb131-2"></a></span>
<span id="cb131-3"><a href="#cb131-3"></a>node2vec <span class="op">=</span> Node2Vec(filteredEntityGraph, dimensions<span class="op">=</span><span class="dv">5</span>) </span>
<span id="cb131-4"><a href="#cb131-4"></a>model <span class="op">=</span> node2vec.fit(window<span class="op">=</span><span class="dv">10</span>) </span>
<span id="cb131-5"><a href="#cb131-5"></a>embeddings <span class="op">=</span> model.wv </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing transition probabilities: 100%|██████████| 2265/2265 [00:07&lt;00:00, 321.05it/s]
Generating walks (CPU: 1): 100%|██████████| 10/10 [01:45&lt;00:00, 10.55s/it]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="cb133-2"><a href="#cb133-2"></a>tsne<span class="op">=</span>TSNE(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb133-3"><a href="#cb133-3"></a>embedding2d<span class="op">=</span>tsne.fit_transform(embeddings.vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a>plt.plot(embedding2d[:, <span class="dv">0</span>], embedding2d[:, <span class="dv">1</span>], <span class="st">'o'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-104-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Using Node2Vec</p>
<p>Node2Vec allows also to compute a similarity between entities</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a>embeddings.most_similar(positive<span class="op">=</span>[<span class="st">"turkey"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<pre><code>[('turkish', 0.9921346306800842),
 ('lira', 0.987409234046936),
 ('debts', 0.9794315099716187),
 ('coastal', 0.9783217906951904),
 ('athens', 0.9770432710647583),
 ('greece', 0.9727554321289062),
 ('benefits', 0.9630903601646423),
 ('carolina', 0.962989330291748),
 ('sharp', 0.9628170728683472),
 ('jones', 0.9522427320480347)]</code></pre>
</div>
</div>
</section>
<section id="document-document-graph-projection" class="level3">
<h3 class="anchored" data-anchor-id="document-document-graph-projection">Document-Document Graph Projection</h3>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a><span class="im">from</span> networkx.algorithms.bipartite.projection <span class="im">import</span> overlap_weighted_projected_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1"></a>documentGraph <span class="op">=</span> overlap_weighted_projected_graph(</span>
<span id="cb138-2"><a href="#cb138-2"></a>    G, </span>
<span id="cb138-3"><a href="#cb138-3"></a>    {n <span class="cf">for</span> n, d <span class="kw">in</span> G.nodes(data<span class="op">=</span><span class="va">True</span>) <span class="cf">if</span> d[<span class="st">"bipartite"</span>] <span class="op">==</span> <span class="dv">0</span>}</span>
<span id="cb138-4"><a href="#cb138-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a><span class="bu">print</span>(nx.info(documentGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 10788
Number of edges: 12994465
Average degree: 2409.0591</code></pre>
</div>
</div>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1"></a>degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(documentGraph)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a>plotDistribution(degrees, <span class="dv">100</span>)</span>
<span id="cb143-2"><a href="#cb143-2"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-111-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1"></a>allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> documentGraph.edges(data<span class="op">=</span><span class="va">True</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="112">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1"></a>plotDistribution(allEdgesWeights, <span class="dv">100</span>)</span>
<span id="cb146-2"><a href="#cb146-2"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb146-3"><a href="#cb146-3"></a>plt.xlim([<span class="fl">1E-2</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>(0.01, 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-113-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb148-2"><a href="#cb148-2"></a></span>
<span id="cb148-3"><a href="#cb148-3"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb148-4"><a href="#cb148-4"></a>plotDistribution(degrees, <span class="dv">13</span>)</span>
<span id="cb148-5"><a href="#cb148-5"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb148-6"><a href="#cb148-6"></a>plt.title(<span class="st">"Degree Distribution"</span>)</span>
<span id="cb148-7"><a href="#cb148-7"></a></span>
<span id="cb148-8"><a href="#cb148-8"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb148-9"><a href="#cb148-9"></a>plotDistribution(allEdgesWeights, <span class="dv">20</span>)</span>
<span id="cb148-10"><a href="#cb148-10"></a>plt.xlim([<span class="fl">1E-2</span>, <span class="dv">10</span>])</span>
<span id="cb148-11"><a href="#cb148-11"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb148-12"><a href="#cb148-12"></a>plt.title(<span class="st">"Edge Weight Distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>Text(0.5, 1.0, 'Edge Weight Distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-114-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1"></a>filteredDocumentGraph <span class="op">=</span> documentGraph.edge_subgraph(</span>
<span id="cb150-2"><a href="#cb150-2"></a>    allEdgesWeights[(allEdgesWeights<span class="op">&gt;</span><span class="fl">0.6</span>)].index.tolist()</span>
<span id="cb150-3"><a href="#cb150-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a><span class="bu">print</span>(nx.info(filteredDocumentGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 1958
Number of edges: 7884
Average degree:   8.0531</code></pre>
</div>
</div>
<section id="global-and-local-properties" class="level4">
<h4 class="anchored" data-anchor-id="global-and-local-properties">Global and Local Properties</h4>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a>degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(filteredDocumentGraph)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1"></a>plotDistribution(degrees, <span class="dv">100</span>)</span>
<span id="cb154-2"><a href="#cb154-2"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-118-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1"></a>allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> filteredDocumentGraph.edges(data<span class="op">=</span><span class="va">True</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="119">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1"></a>plotDistribution(allEdgesWeights, <span class="dv">100</span>)</span>
<span id="cb157-2"><a href="#cb157-2"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb157-3"><a href="#cb157-3"></a>plt.xlim([<span class="fl">1E-1</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>(0.1, 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-120-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb159-2"><a href="#cb159-2"></a></span>
<span id="cb159-3"><a href="#cb159-3"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb159-4"><a href="#cb159-4"></a>plotDistribution(degrees, <span class="dv">13</span>)</span>
<span id="cb159-5"><a href="#cb159-5"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb159-6"><a href="#cb159-6"></a>plt.title(<span class="st">"Degree Distribution"</span>)</span>
<span id="cb159-7"><a href="#cb159-7"></a></span>
<span id="cb159-8"><a href="#cb159-8"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb159-9"><a href="#cb159-9"></a>plotDistribution(allEdgesWeights, <span class="dv">20</span>)</span>
<span id="cb159-10"><a href="#cb159-10"></a>plt.xlim([<span class="fl">1E-2</span>, <span class="dv">10</span>])</span>
<span id="cb159-11"><a href="#cb159-11"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb159-12"><a href="#cb159-12"></a>plt.title(<span class="st">"Edge Weight Distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<pre><code>Text(0.5, 1.0, 'Edge Weight Distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-121-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="core---periphery-description-and-analysis" class="level4">
<h4 class="anchored" data-anchor-id="core---periphery-description-and-analysis">Core - Periphery Description and Analysis</h4>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1"></a><span class="co">#Create network layout for visualizations</span></span>
<span id="cb161-2"><a href="#cb161-2"></a>spring_pos <span class="op">=</span> nx.spring_layout(filteredDocumentGraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1"></a>default_edge_color <span class="op">=</span> <span class="st">'gray'</span></span>
<span id="cb162-2"><a href="#cb162-2"></a>default_node_color <span class="op">=</span> <span class="st">'#407cc9'</span></span>
<span id="cb162-3"><a href="#cb162-3"></a>enhanced_node_color <span class="op">=</span> <span class="st">'#f5b042'</span></span>
<span id="cb162-4"><a href="#cb162-4"></a>enhanced_edge_color <span class="op">=</span> <span class="st">'#cc2f04'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb163-2"><a href="#cb163-2"></a>nx.draw_networkx(filteredDocumentGraph, pos<span class="op">=</span>spring_pos, node_color<span class="op">=</span>default_node_color, </span>
<span id="cb163-3"><a href="#cb163-3"></a>                 edge_color<span class="op">=</span>default_edge_color, with_labels<span class="op">=</span><span class="va">False</span>, node_size<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-124-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a>components <span class="op">=</span> pd.Series({ith: component </span>
<span id="cb164-2"><a href="#cb164-2"></a>              <span class="cf">for</span> ith, component <span class="kw">in</span> <span class="bu">enumerate</span>(nx.connected_components(filteredDocumentGraph))})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1"></a>plotDistribution(components.<span class="bu">apply</span>(<span class="bu">len</span>), nbins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb165-2"><a href="#cb165-2"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-126-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a>coreDocumentGraph <span class="op">=</span> nx.subgraph(</span>
<span id="cb166-2"><a href="#cb166-2"></a>    filteredDocumentGraph,</span>
<span id="cb166-3"><a href="#cb166-3"></a>    [node <span class="cf">for</span> nodes <span class="kw">in</span> components[components.<span class="bu">apply</span>(<span class="bu">len</span>)<span class="op">&gt;</span><span class="dv">8</span>].values <span class="cf">for</span> node <span class="kw">in</span> nodes]</span>
<span id="cb166-4"><a href="#cb166-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="to-be-visualized-in-gephi" class="level1">
<h1>To be visualized in Gephi</h1>
<p>nx.write_gexf(coreDocumentGraph,“coreGraph.gexf”)</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1"></a><span class="bu">print</span>(nx.info(coreDocumentGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 1050
Number of edges: 7112
Average degree:  13.5467</code></pre>
</div>
</div>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1"></a>degrees <span class="op">=</span> pd.Series({k: v <span class="cf">for</span> k, v <span class="kw">in</span> nx.degree(coreDocumentGraph)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a>plotDistribution(degrees, <span class="dv">100</span>)</span>
<span id="cb170-2"><a href="#cb170-2"></a>plt.yscale(<span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/deusebio/.pyenv/versions/3.7.6/envs/ml-book-7/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6694: RuntimeWarning: invalid value encountered in multiply
  boffset = -0.5 * dr * totwidth * (1 - 1 / nx)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-130-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1"></a>allEdgesWeights <span class="op">=</span> pd.Series({(d[<span class="dv">0</span>], d[<span class="dv">1</span>]): d[<span class="dv">2</span>][<span class="st">"weight"</span>] <span class="cf">for</span> d <span class="kw">in</span> coreDocumentGraph.edges(data<span class="op">=</span><span class="va">True</span>)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="131">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1"></a>plotDistribution(allEdgesWeights, <span class="dv">100</span>)</span>
<span id="cb173-2"><a href="#cb173-2"></a>plt.yscale(<span class="st">"log"</span>)</span>
<span id="cb173-3"><a href="#cb173-3"></a>plt.xlim([<span class="fl">1E-1</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>(0.1, 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-132-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1"></a><span class="co">#Create network layout for visualizations</span></span>
<span id="cb175-2"><a href="#cb175-2"></a>spring_pos <span class="op">=</span> nx.spring_layout(coreDocumentGraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a>default_edge_color <span class="op">=</span> <span class="st">'gray'</span></span>
<span id="cb176-2"><a href="#cb176-2"></a>default_node_color <span class="op">=</span> <span class="st">'#407cc9'</span></span>
<span id="cb176-3"><a href="#cb176-3"></a>enhanced_node_color <span class="op">=</span> <span class="st">'#f5b042'</span></span>
<span id="cb176-4"><a href="#cb176-4"></a>enhanced_edge_color <span class="op">=</span> <span class="st">'#cc2f04'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1"></a>plt.axis(<span class="st">"off"</span>)</span>
<span id="cb177-2"><a href="#cb177-2"></a>nx.draw_networkx(coreDocumentGraph, pos<span class="op">=</span>spring_pos, node_color<span class="op">=</span>default_node_color, </span>
<span id="cb177-3"><a href="#cb177-3"></a>                 edge_color<span class="op">=</span>default_edge_color, with_labels<span class="op">=</span><span class="va">False</span>, node_size<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-136-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="community-detection-and-topics-clustering" class="level4">
<h4 class="anchored" data-anchor-id="community-detection-and-topics-clustering">Community Detection and Topics Clustering</h4>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1"></a><span class="im">import</span> community</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1"></a>communities <span class="op">=</span> pd.Series(community.best_partition(coreDocumentGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1"></a>communities <span class="op">=</span> pd.Series(community.best_partition(filteredDocumentGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb181-2"><a href="#cb181-2"></a></span>
<span id="cb181-3"><a href="#cb181-3"></a><span class="kw">def</span> getTopicRatio(df):</span>
<span id="cb181-4"><a href="#cb181-4"></a>    <span class="cf">return</span> Counter([label <span class="cf">for</span> labels <span class="kw">in</span> df[<span class="st">"label"</span>] <span class="cf">for</span> label <span class="kw">in</span> labels])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1"></a>communityTopics <span class="op">=</span> pd.DataFrame.from_dict({</span>
<span id="cb182-2"><a href="#cb182-2"></a>    cid: getTopicRatio(corpus.loc[comm.index])</span>
<span id="cb182-3"><a href="#cb182-3"></a>    <span class="cf">for</span> cid, comm <span class="kw">in</span> communities.groupby(communities)</span>
<span id="cb182-4"><a href="#cb182-4"></a>}, orient<span class="op">=</span><span class="st">"index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1"></a>normalizedCommunityTopics <span class="op">=</span> (communityTopics.T <span class="op">/</span> communityTopics.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1"></a>normalizedCommunityTopics.std(axis<span class="op">=</span><span class="dv">1</span>).fillna(<span class="dv">0</span>).hist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="141">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-143-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1"></a>normalizedCommunityTopics.<span class="bu">apply</span>(<span class="kw">lambda</span> x: np.mean(<span class="op">-</span>np.log(x)), axis<span class="op">=</span><span class="dv">1</span>).hist()</span>
<span id="cb186-2"><a href="#cb186-2"></a>plt.xlabel(<span class="st">"Entropy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>Text(0.5, 0, 'Entropy')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-144-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1"></a>topicsCorrelation <span class="op">=</span> normalizedCommunityTopics.corr().fillna(<span class="dv">0</span>)</span>
<span id="cb188-2"><a href="#cb188-2"></a>topicsCorrelation[topicsCorrelation<span class="op">&lt;</span><span class="fl">0.8</span>]<span class="op">=</span><span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1"></a>topicsGraph <span class="op">=</span> nx.from_pandas_adjacency(topicsCorrelation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb190-2"><a href="#cb190-2"></a></span>
<span id="cb190-3"><a href="#cb190-3"></a>pos <span class="op">=</span> nx.spring_layout(topicsGraph, k<span class="op">=</span><span class="fl">0.35</span>) <span class="co"># k regulates the distance between nodes</span></span>
<span id="cb190-4"><a href="#cb190-4"></a></span>
<span id="cb190-5"><a href="#cb190-5"></a>nx.draw(topicsGraph, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'skyblue'</span>, node_size<span class="op">=</span><span class="dv">1500</span>, edge_cmap<span class="op">=</span>plt.cm.Blues, pos <span class="op">=</span> pos)</span>
<span id="cb190-6"><a href="#cb190-6"></a></span>
<span id="cb190-7"><a href="#cb190-7"></a><span class="co"># plt.show()</span></span>
<span id="cb190-8"><a href="#cb190-8"></a><span class="co"># plt.savefig(os.path.join(".", "TopicsAll.png"), dpi=300, format="png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-147-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1"></a>filteredTopicsGraph <span class="op">=</span> nx.subgraph(</span>
<span id="cb191-2"><a href="#cb191-2"></a>    topicsGraph,</span>
<span id="cb191-3"><a href="#cb191-3"></a>    [node <span class="cf">for</span> component <span class="kw">in</span> nx.connected_components(topicsGraph) <span class="cf">if</span> <span class="bu">len</span>(component)<span class="op">&gt;</span><span class="dv">3</span> <span class="cf">for</span> node <span class="kw">in</span> component]</span>
<span id="cb191-4"><a href="#cb191-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb192-2"><a href="#cb192-2"></a></span>
<span id="cb192-3"><a href="#cb192-3"></a>pos <span class="op">=</span> nx.kamada_kawai_layout(filteredTopicsGraph) <span class="co"># k regulates the distance between nodes</span></span>
<span id="cb192-4"><a href="#cb192-4"></a></span>
<span id="cb192-5"><a href="#cb192-5"></a>nx.draw(filteredTopicsGraph, with_labels<span class="op">=</span><span class="va">True</span>, node_color<span class="op">=</span><span class="st">'skyblue'</span>, node_size<span class="op">=</span><span class="dv">1500</span>, </span>
<span id="cb192-6"><a href="#cb192-6"></a>        edge_cmap<span class="op">=</span>plt.cm.Blues, pos <span class="op">=</span> pos)</span>
<span id="cb192-7"><a href="#cb192-7"></a></span>
<span id="cb192-8"><a href="#cb192-8"></a><span class="co"># plt.show()</span></span>
<span id="cb192-9"><a href="#cb192-9"></a><span class="co"># plt.savefig(os.path.join(".", "TopicsCore.png"), dpi=300, format="png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-149-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="to-be-visualized-in-gephi-1" class="level1">
<h1>To be visualized in Gephi</h1>
<p>nx.write_gexf(coreDocumentGraph, “coreDocumentGraph”)</p>
<section id="embeddings-for-the-document-document-graph" class="level4">
<h4 class="anchored" data-anchor-id="embeddings-for-the-document-document-graph">Embeddings for the Document-Document Graph</h4>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1"></a><span class="im">from</span> node2vec <span class="im">import</span> Node2Vec</span>
<span id="cb193-2"><a href="#cb193-2"></a></span>
<span id="cb193-3"><a href="#cb193-3"></a>node2vec <span class="op">=</span> Node2Vec(coreDocumentGraph, dimensions<span class="op">=</span><span class="dv">20</span>) </span>
<span id="cb193-4"><a href="#cb193-4"></a>model <span class="op">=</span> node2vec.fit(window<span class="op">=</span><span class="dv">10</span>) </span>
<span id="cb193-5"><a href="#cb193-5"></a>embeddings <span class="op">=</span> model.wv </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing transition probabilities: 100%|██████████| 1050/1050 [00:54&lt;00:00, 19.18it/s]
Generating walks (CPU: 1): 100%|██████████| 10/10 [00:47&lt;00:00,  4.70s/it]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="cb195-2"><a href="#cb195-2"></a></span>
<span id="cb195-3"><a href="#cb195-3"></a>tsne<span class="op">=</span>TSNE(n_components<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1"></a>embedding2d<span class="op">=</span>tsne.fit_transform(embeddings.vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1"></a>plt.plot(embedding2d[:, <span class="dv">0</span>], embedding2d[:, <span class="dv">1</span>], <span class="st">'o'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_nlp_graph_creation_files/figure-html/cell-153-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1"></a>pd.DataFrame(embeddings.vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>13</th>
      <th>14</th>
      <th>15</th>
      <th>16</th>
      <th>17</th>
      <th>18</th>
      <th>19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.960548</td>
      <td>0.535780</td>
      <td>0.385748</td>
      <td>1.101508</td>
      <td>3.875988</td>
      <td>1.070799</td>
      <td>-4.849534</td>
      <td>-1.820060</td>
      <td>-2.966034</td>
      <td>1.655846</td>
      <td>1.737207</td>
      <td>-3.332000</td>
      <td>-5.323652</td>
      <td>-4.393471</td>
      <td>-1.154701</td>
      <td>0.506530</td>
      <td>-1.585463</td>
      <td>-4.248538</td>
      <td>2.294325</td>
      <td>3.957590</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.162390</td>
      <td>0.251178</td>
      <td>0.186549</td>
      <td>0.988687</td>
      <td>3.733672</td>
      <td>0.626086</td>
      <td>-4.566340</td>
      <td>-2.196690</td>
      <td>-2.987178</td>
      <td>1.805605</td>
      <td>2.033937</td>
      <td>-3.546881</td>
      <td>-4.945525</td>
      <td>-4.785186</td>
      <td>-0.997341</td>
      <td>0.217447</td>
      <td>-1.068717</td>
      <td>-4.298778</td>
      <td>2.283113</td>
      <td>3.929447</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.560644</td>
      <td>0.339182</td>
      <td>0.291281</td>
      <td>1.226845</td>
      <td>4.163576</td>
      <td>0.812360</td>
      <td>-4.543347</td>
      <td>-2.294925</td>
      <td>-2.825094</td>
      <td>1.498989</td>
      <td>1.761113</td>
      <td>-3.436803</td>
      <td>-4.634498</td>
      <td>-4.171238</td>
      <td>-1.194322</td>
      <td>0.629293</td>
      <td>-1.354635</td>
      <td>-4.453906</td>
      <td>1.763564</td>
      <td>3.575306</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-2.838000</td>
      <td>-0.670331</td>
      <td>1.331425</td>
      <td>-2.872283</td>
      <td>0.375439</td>
      <td>4.298521</td>
      <td>-0.158841</td>
      <td>-0.170265</td>
      <td>-2.612220</td>
      <td>0.694892</td>
      <td>3.447092</td>
      <td>-2.284607</td>
      <td>-2.858946</td>
      <td>-4.312414</td>
      <td>-5.989464</td>
      <td>-0.026698</td>
      <td>-1.416963</td>
      <td>-5.212801</td>
      <td>-4.163705</td>
      <td>-0.600494</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-2.556705</td>
      <td>0.965237</td>
      <td>-0.061232</td>
      <td>1.352170</td>
      <td>4.276524</td>
      <td>1.577441</td>
      <td>-2.324412</td>
      <td>-0.380508</td>
      <td>-2.863870</td>
      <td>1.455134</td>
      <td>3.609730</td>
      <td>-4.132732</td>
      <td>-2.480354</td>
      <td>-0.950713</td>
      <td>-2.587649</td>
      <td>0.175977</td>
      <td>-1.113148</td>
      <td>-5.748485</td>
      <td>-2.448518</td>
      <td>1.200612</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1045</th>
      <td>0.331984</td>
      <td>0.523769</td>
      <td>0.103705</td>
      <td>0.561897</td>
      <td>0.521912</td>
      <td>-0.852221</td>
      <td>-1.032729</td>
      <td>0.337699</td>
      <td>0.679176</td>
      <td>0.848446</td>
      <td>-0.056654</td>
      <td>-0.641469</td>
      <td>-0.082838</td>
      <td>0.306723</td>
      <td>-0.225306</td>
      <td>-0.910874</td>
      <td>-0.478912</td>
      <td>-0.061075</td>
      <td>-0.083310</td>
      <td>-0.278903</td>
    </tr>
    <tr>
      <th>1046</th>
      <td>0.166020</td>
      <td>-0.576071</td>
      <td>0.473827</td>
      <td>-0.074774</td>
      <td>0.542515</td>
      <td>-0.566927</td>
      <td>0.635151</td>
      <td>0.547837</td>
      <td>0.188676</td>
      <td>-0.798186</td>
      <td>-0.598822</td>
      <td>0.590872</td>
      <td>-0.403117</td>
      <td>0.617905</td>
      <td>1.012607</td>
      <td>0.195247</td>
      <td>0.337702</td>
      <td>0.182143</td>
      <td>0.600068</td>
      <td>-0.636223</td>
    </tr>
    <tr>
      <th>1047</th>
      <td>0.471930</td>
      <td>-0.705889</td>
      <td>0.055459</td>
      <td>-0.975193</td>
      <td>0.099381</td>
      <td>-0.253793</td>
      <td>0.181459</td>
      <td>-0.095714</td>
      <td>0.663958</td>
      <td>-1.006062</td>
      <td>-0.361706</td>
      <td>0.433246</td>
      <td>1.090418</td>
      <td>0.211187</td>
      <td>-0.207774</td>
      <td>-0.705345</td>
      <td>0.371806</td>
      <td>0.108446</td>
      <td>0.908669</td>
      <td>-1.126879</td>
    </tr>
    <tr>
      <th>1048</th>
      <td>-0.236891</td>
      <td>0.118807</td>
      <td>-0.029381</td>
      <td>-0.073577</td>
      <td>-0.089825</td>
      <td>0.016194</td>
      <td>0.573447</td>
      <td>-0.264896</td>
      <td>0.540209</td>
      <td>-0.282678</td>
      <td>-0.073139</td>
      <td>0.051319</td>
      <td>0.419923</td>
      <td>0.305243</td>
      <td>-0.105601</td>
      <td>-0.014267</td>
      <td>-0.833588</td>
      <td>0.948402</td>
      <td>0.214101</td>
      <td>0.181394</td>
    </tr>
    <tr>
      <th>1049</th>
      <td>0.303921</td>
      <td>-0.329447</td>
      <td>-0.198187</td>
      <td>-0.968494</td>
      <td>0.568693</td>
      <td>-0.778354</td>
      <td>0.738360</td>
      <td>-0.507104</td>
      <td>0.589299</td>
      <td>-1.071499</td>
      <td>0.007456</td>
      <td>0.132762</td>
      <td>0.568386</td>
      <td>0.526633</td>
      <td>-0.031978</td>
      <td>0.094264</td>
      <td>0.673068</td>
      <td>0.048564</td>
      <td>0.759775</td>
      <td>-1.122763</td>
    </tr>
  </tbody>
</table>
<p>1050 rows × 20 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1"></a>pd.DataFrame(embeddings.vectors, index<span class="op">=</span>embeddings.index2word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="153">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>13</th>
      <th>14</th>
      <th>15</th>
      <th>16</th>
      <th>17</th>
      <th>18</th>
      <th>19</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>test/20368</th>
      <td>-0.960548</td>
      <td>0.535780</td>
      <td>0.385748</td>
      <td>1.101508</td>
      <td>3.875988</td>
      <td>1.070799</td>
      <td>-4.849534</td>
      <td>-1.820060</td>
      <td>-2.966034</td>
      <td>1.655846</td>
      <td>1.737207</td>
      <td>-3.332000</td>
      <td>-5.323652</td>
      <td>-4.393471</td>
      <td>-1.154701</td>
      <td>0.506530</td>
      <td>-1.585463</td>
      <td>-4.248538</td>
      <td>2.294325</td>
      <td>3.957590</td>
    </tr>
    <tr>
      <th>test/20442</th>
      <td>-1.162390</td>
      <td>0.251178</td>
      <td>0.186549</td>
      <td>0.988687</td>
      <td>3.733672</td>
      <td>0.626086</td>
      <td>-4.566340</td>
      <td>-2.196690</td>
      <td>-2.987178</td>
      <td>1.805605</td>
      <td>2.033937</td>
      <td>-3.546881</td>
      <td>-4.945525</td>
      <td>-4.785186</td>
      <td>-0.997341</td>
      <td>0.217447</td>
      <td>-1.068717</td>
      <td>-4.298778</td>
      <td>2.283113</td>
      <td>3.929447</td>
    </tr>
    <tr>
      <th>test/20221</th>
      <td>-0.560644</td>
      <td>0.339182</td>
      <td>0.291281</td>
      <td>1.226845</td>
      <td>4.163576</td>
      <td>0.812360</td>
      <td>-4.543347</td>
      <td>-2.294925</td>
      <td>-2.825094</td>
      <td>1.498989</td>
      <td>1.761113</td>
      <td>-3.436803</td>
      <td>-4.634498</td>
      <td>-4.171238</td>
      <td>-1.194322</td>
      <td>0.629293</td>
      <td>-1.354635</td>
      <td>-4.453906</td>
      <td>1.763564</td>
      <td>3.575306</td>
    </tr>
    <tr>
      <th>test/16715</th>
      <td>-2.838000</td>
      <td>-0.670331</td>
      <td>1.331425</td>
      <td>-2.872283</td>
      <td>0.375439</td>
      <td>4.298521</td>
      <td>-0.158841</td>
      <td>-0.170265</td>
      <td>-2.612220</td>
      <td>0.694892</td>
      <td>3.447092</td>
      <td>-2.284607</td>
      <td>-2.858946</td>
      <td>-4.312414</td>
      <td>-5.989464</td>
      <td>-0.026698</td>
      <td>-1.416963</td>
      <td>-5.212801</td>
      <td>-4.163705</td>
      <td>-0.600494</td>
    </tr>
    <tr>
      <th>test/20800</th>
      <td>-2.556705</td>
      <td>0.965237</td>
      <td>-0.061232</td>
      <td>1.352170</td>
      <td>4.276524</td>
      <td>1.577441</td>
      <td>-2.324412</td>
      <td>-0.380508</td>
      <td>-2.863870</td>
      <td>1.455134</td>
      <td>3.609730</td>
      <td>-4.132732</td>
      <td>-2.480354</td>
      <td>-0.950713</td>
      <td>-2.587649</td>
      <td>0.175977</td>
      <td>-1.113148</td>
      <td>-5.748485</td>
      <td>-2.448518</td>
      <td>1.200612</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>test/20255</th>
      <td>0.331984</td>
      <td>0.523769</td>
      <td>0.103705</td>
      <td>0.561897</td>
      <td>0.521912</td>
      <td>-0.852221</td>
      <td>-1.032729</td>
      <td>0.337699</td>
      <td>0.679176</td>
      <td>0.848446</td>
      <td>-0.056654</td>
      <td>-0.641469</td>
      <td>-0.082838</td>
      <td>0.306723</td>
      <td>-0.225306</td>
      <td>-0.910874</td>
      <td>-0.478912</td>
      <td>-0.061075</td>
      <td>-0.083310</td>
      <td>-0.278903</td>
    </tr>
    <tr>
      <th>test/20266</th>
      <td>0.166020</td>
      <td>-0.576071</td>
      <td>0.473827</td>
      <td>-0.074774</td>
      <td>0.542515</td>
      <td>-0.566927</td>
      <td>0.635151</td>
      <td>0.547837</td>
      <td>0.188676</td>
      <td>-0.798186</td>
      <td>-0.598822</td>
      <td>0.590872</td>
      <td>-0.403117</td>
      <td>0.617905</td>
      <td>1.012607</td>
      <td>0.195247</td>
      <td>0.337702</td>
      <td>0.182143</td>
      <td>0.600068</td>
      <td>-0.636223</td>
    </tr>
    <tr>
      <th>training/10885</th>
      <td>0.471930</td>
      <td>-0.705889</td>
      <td>0.055459</td>
      <td>-0.975193</td>
      <td>0.099381</td>
      <td>-0.253793</td>
      <td>0.181459</td>
      <td>-0.095714</td>
      <td>0.663958</td>
      <td>-1.006062</td>
      <td>-0.361706</td>
      <td>0.433246</td>
      <td>1.090418</td>
      <td>0.211187</td>
      <td>-0.207774</td>
      <td>-0.705345</td>
      <td>0.371806</td>
      <td>0.108446</td>
      <td>0.908669</td>
      <td>-1.126879</td>
    </tr>
    <tr>
      <th>training/11154</th>
      <td>-0.236891</td>
      <td>0.118807</td>
      <td>-0.029381</td>
      <td>-0.073577</td>
      <td>-0.089825</td>
      <td>0.016194</td>
      <td>0.573447</td>
      <td>-0.264896</td>
      <td>0.540209</td>
      <td>-0.282678</td>
      <td>-0.073139</td>
      <td>0.051319</td>
      <td>0.419923</td>
      <td>0.305243</td>
      <td>-0.105601</td>
      <td>-0.014267</td>
      <td>-0.833588</td>
      <td>0.948402</td>
      <td>0.214101</td>
      <td>0.181394</td>
    </tr>
    <tr>
      <th>training/1532</th>
      <td>0.303921</td>
      <td>-0.329447</td>
      <td>-0.198187</td>
      <td>-0.968494</td>
      <td>0.568693</td>
      <td>-0.778354</td>
      <td>0.738360</td>
      <td>-0.507104</td>
      <td>0.589299</td>
      <td>-1.071499</td>
      <td>0.007456</td>
      <td>0.132762</td>
      <td>0.568386</td>
      <td>0.526633</td>
      <td>-0.031978</td>
      <td>0.094264</td>
      <td>0.673068</td>
      <td>0.048564</td>
      <td>0.759775</td>
      <td>-1.122763</td>
    </tr>
  </tbody>
</table>
<p>1050 rows × 20 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1"></a><span class="bu">print</span>(nx.info(G))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: 
Type: Graph
Number of nodes: 25752
Number of edges: 100311
Average degree:   7.7905</code></pre>
</div>
</div>
<p>Extracting the embeddings to be used in shallow-learning models. Please do vary the <em>dimensions</em> and the <em>window</em> parameters to generate multiple combination to be cross-validated</p>
<div class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb202-2"><a href="#cb202-2"></a>Path(<span class="st">"./embeddings"</span>).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1"></a><span class="im">from</span> node2vec <span class="im">import</span> Node2Vec</span>
<span id="cb203-2"><a href="#cb203-2"></a></span>
<span id="cb203-3"><a href="#cb203-3"></a>dimensions <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb203-4"><a href="#cb203-4"></a>window <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb203-5"><a href="#cb203-5"></a></span>
<span id="cb203-6"><a href="#cb203-6"></a>node2vec <span class="op">=</span> Node2Vec(G, dimensions<span class="op">=</span>dimensions) </span>
<span id="cb203-7"><a href="#cb203-7"></a>model <span class="op">=</span> node2vec.fit(window<span class="op">=</span>window) </span>
<span id="cb203-8"><a href="#cb203-8"></a>embeddings <span class="op">=</span> model.wv </span>
<span id="cb203-9"><a href="#cb203-9"></a></span>
<span id="cb203-10"><a href="#cb203-10"></a>pd.DataFrame(embeddings.vectors, index<span class="op">=</span>embeddings.index2word)<span class="op">\</span></span>
<span id="cb203-11"><a href="#cb203-11"></a>    .to_pickle(<span class="ss">f"./embeddings/bipartiteGraphEmbeddings_</span><span class="sc">{</span>dimensions<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">.p"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing transition probabilities: 100%|██████████| 25752/25752 [03:59&lt;00:00, 107.40it/s] 
Generating walks (CPU: 1): 100%|██████████| 10/10 [34:19&lt;00:00, 205.97s/it]</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="miruetoto/yechan3" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>