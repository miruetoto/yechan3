<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.533">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="최규빈">
<meta name="dcterms.date" content="2024-07-09">

<title>신록예찬’s Blog - (공부) hf – lesson2:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">신록예찬’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DL2024/"> 
<span class="menu-text">DL2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/AP2023/"> 
<span class="menu-text">AP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/PP2024/"> 
<span class="menu-text">PP2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DV2023/"> 
<span class="menu-text">DV2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/MP2023/"> 
<span class="menu-text">MP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/SC2024/"> 
<span class="menu-text">SC2024</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/DS2022/"> 
<span class="menu-text">DS2022</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/SP2023/"> 
<span class="menu-text">SP2023</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://guebin.github.io/IR2021/"> 
<span class="menu-text">IR2021</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan/"> 
<span class="menu-text">yechan</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://miruetoto.github.io/yechan2/"> 
<span class="menu-text">yechan2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/miruetoto/yechan3"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">(공부) hf – lesson2:</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../메모.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">메모</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../공부.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">공부</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../연구.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">연구</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../자료.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">자료</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="lecture2.out.ipynb" download="lecture2.out.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">(공부) hf – lesson2:</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>최규빈 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 9, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="76f0942c-63cc-42e0-a458-69e0fe399a83" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">#!pip install torchtext </span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#!pip install portalocker</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#!pip install accelerate -U</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#!pip install torchdata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0756cc3e-c4d2-4b90-9819-9a851692dacd" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> torchtext.datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f773ce88-0b08-4786-b2e8-f99bc418fbf3" class="cell" data-executioninfo="{&quot;elapsed&quot;:1855,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688388822109,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>train_iter <span class="op">=</span> torchtext.datasets.IMDB(split<span class="op">=</span><span class="st">'train'</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>test_iter <span class="op">=</span> torchtext.datasets.IMDB(split<span class="op">=</span><span class="st">'test'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f3e203a3-2a42-48f9-8ae7-630cea1eaf00" class="cell" data-executioninfo="{&quot;elapsed&quot;:33665,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688388873914,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="96969743-e5a7-44a2-bfa5-df50bfac8ace" data-execution_count="25">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># 런타임 약 30초 소요</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># 출력 결과를 고정하기 위해 random.seed 도입</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="im">import</span> random</span>
<span id="cb4-4"><a href="#cb4-4"></a>random.seed(<span class="dv">6</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co"># train_iter를 리스트 타입으로 변경</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>train_lists <span class="op">=</span> <span class="bu">list</span>(train_iter)</span>
<span id="cb4-8"><a href="#cb4-8"></a>test_lists <span class="op">=</span> <span class="bu">list</span>(test_iter)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># 각기 1000개씩 랜덤 샘플링</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>train_lists_small <span class="op">=</span> random.sample(train_lists, <span class="dv">1000</span>)</span>
<span id="cb4-12"><a href="#cb4-12"></a>test_lists_small <span class="op">=</span> random.sample(test_lists, <span class="dv">1000</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co"># 각 변수에 담긴 인덱스 0에 해당하는 원소, 즉 첫번째 원소 출력</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="bu">print</span>(train_lists_small[<span class="dv">0</span>])</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="bu">print</span>(test_lists_small[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(2, "I LOVED this movie! I am biased seeing as I am a huge Disney fan, but I really enjoyed myself. The action takes off running in the beginning of the film and just keeps going! This is a bit of a departure for Disney, they don't spend quite as much time on character development (my husband pointed this out)and there are no musical numbers. It is strictly action adventure. I thoroughly enjoyed it and recommend it to anyone who loves Disney, be they young or old.")
(1, 'This was an abysmal show. In short it was about this kid called Doug who guilt-tripped a lot. Seriously he could feel guilty over killing a fly then feeling guilty over feeling guilty for killing the fly and so forth. The animation was grating and unpleasant and the jokes cheap. &lt;br /&gt;&lt;br /&gt;It aired here in Sweden as a part of the "Disney time" show and i remember liking it some what but then i turned 13.&lt;br /&gt;&lt;br /&gt;I never got why some of the characters were green and purple too. What was up with that? &lt;br /&gt;&lt;br /&gt;Truly a horrible show. Appareantly it spawned a movie which i\'ve never seen but i don\'t have any great expectations for that one either.')</code></pre>
</div>
</div>
<div id="3b3d394e-cc59-4872-ae4f-b7c92ffa08d0" class="cell" data-executioninfo="{&quot;elapsed&quot;:3,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389030990,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="bfcf7c19-60e0-4822-dc2d-7f43b6b86b7c" data-execution_count="28">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># train_texts와 train_labels라는 컨테이너 생성</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># 아래 반복분에서 생성된 결과를 담는 그릇으로서 역할 수행</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>train_texts <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4"></a>train_labels <span class="op">=</span> []</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co"># for 반복문</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># train_lists_small에 담긴 튜플 쌍 원소를 변수명 label과 text를 부여하여 순서대로 추출</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="cf">for</span> label, text <span class="kw">in</span> train_lists_small:</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="co"># IMDB 데이터의 기존 레이블 2를 1로 변경, 기존 레이블 1을 0으로 변경</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  train_labels.append(<span class="dv">1</span> <span class="cf">if</span> label <span class="op">==</span> <span class="dv">2</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb6-11"><a href="#cb6-11"></a>  train_texts.append(text)</span>
<span id="cb6-12"><a href="#cb6-12"></a></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co"># text_texts와 test_labels라는 컨테이너 생성</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>test_texts <span class="op">=</span> []</span>
<span id="cb6-15"><a href="#cb6-15"></a>test_labels <span class="op">=</span> []</span>
<span id="cb6-16"><a href="#cb6-16"></a></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co"># for 반복문</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="cf">for</span> label, text <span class="kw">in</span> test_lists_small:</span>
<span id="cb6-19"><a href="#cb6-19"></a>  <span class="co"># IMDB 데이터의 기존 레이블 2를 1로 변경, 기존 레이블 1을 0으로 변경</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>  test_labels.append(<span class="dv">1</span> <span class="cf">if</span> label <span class="op">==</span> <span class="dv">2</span> <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb6-21"><a href="#cb6-21"></a>  test_texts.append(text)</span>
<span id="cb6-22"><a href="#cb6-22"></a></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co"># 각 변수에 담긴 인덱스 0에 해당하는 원소, 즉 첫번째 원소 출력</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="bu">print</span>(train_texts[<span class="dv">0</span>])</span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="bu">print</span>(train_labels[<span class="dv">0</span>])</span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="bu">print</span>(test_texts[<span class="dv">0</span>])</span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="bu">print</span>(test_labels[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>I LOVED this movie! I am biased seeing as I am a huge Disney fan, but I really enjoyed myself. The action takes off running in the beginning of the film and just keeps going! This is a bit of a departure for Disney, they don't spend quite as much time on character development (my husband pointed this out)and there are no musical numbers. It is strictly action adventure. I thoroughly enjoyed it and recommend it to anyone who loves Disney, be they young or old.
1
This was an abysmal show. In short it was about this kid called Doug who guilt-tripped a lot. Seriously he could feel guilty over killing a fly then feeling guilty over feeling guilty for killing the fly and so forth. The animation was grating and unpleasant and the jokes cheap. &lt;br /&gt;&lt;br /&gt;It aired here in Sweden as a part of the "Disney time" show and i remember liking it some what but then i turned 13.&lt;br /&gt;&lt;br /&gt;I never got why some of the characters were green and purple too. What was up with that? &lt;br /&gt;&lt;br /&gt;Truly a horrible show. Appareantly it spawned a movie which i've never seen but i don't have any great expectations for that one either.
0</code></pre>
</div>
</div>
<div id="0dacf442-bd0b-4f52-8bcc-e534e48f9412" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#!pip install scikit-learn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f7e895b5-1f52-4291-83f4-974457d3058e" class="cell" data-executioninfo="{&quot;elapsed&quot;:1314,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389041084,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="d38b4ec5-5c39-4d1c-bebe-abf88e04bc4e" data-execution_count="33">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># train_test_split 결과를 고정하기 위해 random_state 지정</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb9-3"><a href="#cb9-3"></a>train_texts, val_texts, train_labels, val_labels <span class="op">=</span> train_test_split(train_texts, train_labels, test_size<span class="op">=</span><span class="fl">.2</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>                                                                    random_state<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="bu">print</span>(<span class="bu">len</span>(train_texts))</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="bu">print</span>(<span class="bu">len</span>(train_labels))</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="bu">print</span>(<span class="bu">len</span>(val_texts))</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="bu">print</span>(<span class="bu">len</span>(val_labels))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>800
800
200
200</code></pre>
</div>
</div>
<div id="bfd546fc-5ffa-4f00-8554-06157fc7281d" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>tokenizer <span class="op">=</span> transformers.DistilBertTokenizerFast.from_pretrained(<span class="st">'distilbert-base-uncased'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/huggingface_hub-0.23.4-py3.8.egg/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.</code></pre>
</div>
</div>
<div id="52bb139a-3b37-4455-8ac3-506ada5ac408" class="cell" data-executioninfo="{&quot;elapsed&quot;:5430,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389068783,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="10a940ac-a63d-4def-dd48-19b252a9fb1b" data-execution_count="35">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 토크나이징을 통한 인코딩</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>train_encodings <span class="op">=</span> tokenizer(train_texts, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a>val_encodings <span class="op">=</span> tokenizer(val_texts, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>test_encodings <span class="op">=</span> tokenizer(test_texts, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co"># # 0번째 입력문(텍스트)의 5번째 토큰까지의 input_ids 출력</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="bu">print</span>(train_encodings[<span class="st">"input_ids"</span>][<span class="dv">0</span>][:<span class="dv">5</span>])</span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co"># 위의 결과를 디코딩하여 출력</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="bu">print</span>(tokenizer.decode(train_encodings[<span class="st">"input_ids"</span>][<span class="dv">0</span>][:<span class="dv">5</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[101, 4937, 11350, 2038, 2048]
[CLS] cat soup has two</code></pre>
</div>
</div>
<div id="670beb6c-0855-44db-a9a9-1c7866d5d198" class="cell" data-executioninfo="{&quot;elapsed&quot;:467,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389082052,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-execution_count="56">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Dataset 클래스를 상속하는 IMDBDataset 클래스를 정의</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">class</span> IMDbDataset(torch.utils.data.Dataset):</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="co"># 생성자 __init__()</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="co"># 자신을 가르키는 매개변수 self 포함</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="co"># 변수를 저장하기 위해 self.변수명을 사용</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, encodings, labels):</span>
<span id="cb15-8"><a href="#cb15-8"></a>        <span class="va">self</span>.encodings <span class="op">=</span> encodings</span>
<span id="cb15-9"><a href="#cb15-9"></a>        <span class="va">self</span>.labels <span class="op">=</span> labels</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>    <span class="co"># 자신을 가르키는 매개변수 self 포함</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx):</span>
<span id="cb15-13"><a href="#cb15-13"></a>        <span class="co"># self.encoding에 담긴 키(key)와 키값(value)을 items()로 추출</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>        <span class="co"># 이 값을 key와 val 변수에 담아 새로운 키(key)와 키값(torch.tensor(val[idx]))를 갖는 딕셔너리 생성</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>        <span class="co"># 딕셔너리는 {"key1:value1", "key2:value2", ,,,} 형태를 지닌 파이썬 데이터 구조</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>        <span class="co"># val[idx]에 담긴 데이터를 torch.tensor()를 통해 파이토치 텐서로 변환</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>        item <span class="op">=</span> {key: torch.tensor(val[idx]) <span class="cf">for</span> key, val <span class="kw">in</span> <span class="va">self</span>.encodings.items()}</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>        <span class="co"># self.lables[idx]에 담긴 데이터를 torch.tensor()를 통해 파이토치 텐서 변환</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>        item[<span class="st">'labels'</span>] <span class="op">=</span> torch.tensor(<span class="va">self</span>.labels[idx])</span>
<span id="cb15-21"><a href="#cb15-21"></a>        <span class="cf">return</span> item</span>
<span id="cb15-22"><a href="#cb15-22"></a></span>
<span id="cb15-23"><a href="#cb15-23"></a>    <span class="co"># 자신을 가르키는 매개변수 self 포함</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb15-25"><a href="#cb15-25"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.labels)</span>
<span id="cb15-26"><a href="#cb15-26"></a></span>
<span id="cb15-27"><a href="#cb15-27"></a>train_dataset <span class="op">=</span> IMDbDataset(train_encodings, train_labels)</span>
<span id="cb15-28"><a href="#cb15-28"></a>val_dataset <span class="op">=</span> IMDbDataset(val_encodings, val_labels)</span>
<span id="cb15-29"><a href="#cb15-29"></a>test_dataset <span class="op">=</span> IMDbDataset(test_encodings, test_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="51cd249e-92b1-4bcb-8b8b-24955464b9cc" class="cell" data-executioninfo="{&quot;elapsed&quot;:651,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389087047,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="93186b60-a6cb-4806-e16f-0f135e2722a2" data-execution_count="57">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="cf">for</span> i <span class="kw">in</span> train_dataset:</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="bu">print</span>(i)</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'input_ids': tensor([  101,  4937, 11350,  2038,  2048,  1000,  7592, 14433,  1000,  1011,
         2828, 18401,  2015, 28866,  2075,  2006,  1037, 13576,  4440,  2083,
         1996, 25115,  1010,  2073,  2505,  2064,  4148,  1010,  1998,  2515,
         1012,  2023,  2568,  1011,  4440,  4691,  4004,  2460,  3594,  2053,
        13764,  8649,  1010,  4942, 21532,  2773, 22163,  2612,  1012,  2045,
         2003,  2053,  2126,  1997,  7851,  2023, 17183, 14088,  9476,  3272,
         2000,  2425,  2017,  2000,  2156,  2009,  2005,  4426,  1012,  1998,
         2191,  2469,  2053,  2028,  2104,  2184,  2003,  1999,  1996,  2282,
         1012,  4487,  6491,  6633,  5677,  3672,  1998,  2064,  3490, 10264,
         2964,  1998, 18186,  1998,  9576,  2854,  1998,  5573,  2331,  1998,
         2655,  3560, 27770,  2005,  2500,  2024,  2691,  6991,  1012,  7481,
         1012,  3383,  1996,  2087, 13432,  3746,  2003,  2008,  1997,  2019,
        10777,  3605,  1997,  2300,  2008,  1996,  8934,  7368,  9880,  2083,
         1998,  1999,  1010,  1998,  2036,  4536,  1012,  2021,  2066,  8134,
         2673,  2842,  1999,  2023,  2143,  1010,  2008, 10021,  1010, 27263,
        17933,  4226, 25347,  2574,  3310,  2000,  1037,  9202,  2203,  1012,
          102,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0,     0,     0,     0,     0,     0,     0,     0,     0,
            0,     0]), 'attention_mask': tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0]), 'labels': tensor(1)}</code></pre>
</div>
</div>
<div id="82d26d08-c484-4929-87d5-e79be371a811" class="cell" data-executioninfo="{&quot;elapsed&quot;:3598,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389115429,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="26f5345f-a781-49cd-8214-5128b11a1ca6" data-execution_count="58">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># distilbert 모델 불러오기</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>model <span class="op">=</span> transformers.DistilBertForSequenceClassification.from_pretrained(<span class="st">"distilbert-base-uncased"</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a>model <span class="op">=</span> model.to(<span class="st">"cuda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/huggingface_hub-0.23.4-py3.8.egg/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
Some weights of DistilBertForSequenceClassification were not initialized from the model checkpoint at distilbert-base-uncased and are newly initialized: ['classifier.bias', 'classifier.weight', 'pre_classifier.bias', 'pre_classifier.weight']
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.</code></pre>
</div>
</div>
<div id="73a1addb-e43d-44d6-a137-7237931d568d" class="cell" data-executioninfo="{&quot;elapsed&quot;:2,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389127210,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-execution_count="59">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>training_args <span class="op">=</span> transformers.TrainingArguments(</span>
<span id="cb20-2"><a href="#cb20-2"></a>    output_dir<span class="op">=</span><span class="st">'./results'</span>,          <span class="co"># 출력 디렉토리 경로</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>    num_train_epochs<span class="op">=</span><span class="dv">8</span>,              <span class="co"># 학습 에포크 수</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>    per_device_train_batch_size<span class="op">=</span><span class="dv">16</span>,  <span class="co"># 학습시 (디바이스 별) 미니 배치 수</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>    per_device_eval_batch_size<span class="op">=</span><span class="dv">64</span>,   <span class="co"># 평가시 (디바이스 별) 미니 배치 수</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>    warmup_steps<span class="op">=</span><span class="dv">500</span>,                <span class="co"># 학습률 스케줄링용 웜업 스텝 수</span></span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a>    weight_decay<span class="op">=</span><span class="fl">0.01</span>,               <span class="co"># 가중치 감쇄 강도</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>    logging_dir<span class="op">=</span><span class="st">'./logs'</span>,            <span class="co"># 로그 디렉토리 경로</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>    logging_steps<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb20-11"><a href="#cb20-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c39057fc-562f-4dc6-b5d4-6adbfd0f6474" class="cell" data-executioninfo="{&quot;elapsed&quot;:3381,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389211877,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="aea6ba59-712b-4d58-e49c-b44984ca27ba" data-execution_count="60">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># 파인튜닝 이전에 세 입력 문장 극성 판별</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co"># 이는 한국어판을 취해 추가된 코드임</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>input_tokens <span class="op">=</span> tokenizer([<span class="st">"I feel fantastic"</span>, <span class="st">"My life is going something wrong"</span>, <span class="st">"I have not figured out what the chosen title has to do with the movie."</span>], truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># 입력 문장 토크나이징 결과(input_tokens)에 담긴 input_ids를 모델에 투입</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co"># 그리고 모델 출력 결과를 GPU로 전송하며 값은 변수 outputs에 저장</span></span>
<span id="cb21-7"><a href="#cb21-7"></a>outputs <span class="op">=</span> model(torch.tensor(input_tokens[<span class="st">'input_ids'</span>]).to(<span class="st">"cuda:0"</span>))</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co"># 레이블 딕셔너리 생성</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>label_dict <span class="op">=</span> {<span class="dv">1</span>:<span class="st">'positive'</span>, <span class="dv">0</span>:<span class="st">'negative'</span>}</span>
<span id="cb21-11"><a href="#cb21-11"></a></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co"># outputs 변수에 담긴 logits 값을 행 단위, 즉 입력 문장 단위로 가장 큰 값 위치(인덱스) 추출</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co"># 그 결과값(인덱스)을 cpu로 넘기고 넘파이 타입으로 변경 후, 인덱스에 매칭되는 레이블 출력</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="bu">print</span>([label_dict[i] <span class="cf">for</span> i <span class="kw">in</span> torch.argmax(outputs[<span class="st">'logits'</span>], axis<span class="op">=</span><span class="dv">1</span>).cpu().numpy()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['negative', 'negative', 'positive']</code></pre>
</div>
</div>
<div id="f779446d-cb4f-46dd-b3c7-4c0ee48fb0d9" class="cell" data-executioninfo="{&quot;elapsed&quot;:278004,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389497261,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="e2fa4273-51d9-40d0-89dd-9a7dfecbe17a" data-execution_count="61">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 런타임 약 4 혹은 5분 소요</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co"># 딥러닝 모델의 특성상 결과가 매번 약간 다르게 나올 수 있슴</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>trainer <span class="op">=</span> transformers.Trainer(</span>
<span id="cb23-4"><a href="#cb23-4"></a>    model<span class="op">=</span>model,                      <span class="co"># 사전학습 모델 인스턴스화</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>    args<span class="op">=</span>training_args,               <span class="co"># TrainingArguments에 정의한 하이퍼 파라미터값 가져오기</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>    train_dataset<span class="op">=</span>train_dataset,      <span class="co"># 학습 데이터세트</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    eval_dataset<span class="op">=</span>val_dataset          <span class="co"># evaluation 데이터세트</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>)</span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a>trainer.train()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/accelerate/accelerator.py:447: FutureWarning: Passing the following arguments to `Accelerator` is deprecated and will be removed in version 1.0 of Accelerate: dict_keys(['dispatch_batches', 'split_batches']). Please pass an `accelerate.DataLoaderConfiguration` instead: 
dataloader_config = DataLoaderConfiguration(dispatch_batches=None, split_batches=False)
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-display">

    <div>
      
      <progress value="400" max="400" style="width:300px; height:20px; vertical-align: middle;"></progress>
      [400/400 01:07, Epoch 8/8]
    </div>
    
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Step</th>
<th data-quarto-table-cell-role="th">Training Loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10</td>
<td>0.691700</td>
</tr>
<tr class="even">
<td>20</td>
<td>0.691600</td>
</tr>
<tr class="odd">
<td>30</td>
<td>0.695700</td>
</tr>
<tr class="even">
<td>40</td>
<td>0.691200</td>
</tr>
<tr class="odd">
<td>50</td>
<td>0.688900</td>
</tr>
<tr class="even">
<td>60</td>
<td>0.681200</td>
</tr>
<tr class="odd">
<td>70</td>
<td>0.671200</td>
</tr>
<tr class="even">
<td>80</td>
<td>0.648900</td>
</tr>
<tr class="odd">
<td>90</td>
<td>0.613400</td>
</tr>
<tr class="even">
<td>100</td>
<td>0.562500</td>
</tr>
<tr class="odd">
<td>110</td>
<td>0.522600</td>
</tr>
<tr class="even">
<td>120</td>
<td>0.412300</td>
</tr>
<tr class="odd">
<td>130</td>
<td>0.377300</td>
</tr>
<tr class="even">
<td>140</td>
<td>0.376100</td>
</tr>
<tr class="odd">
<td>150</td>
<td>0.307500</td>
</tr>
<tr class="even">
<td>160</td>
<td>0.281700</td>
</tr>
<tr class="odd">
<td>170</td>
<td>0.274100</td>
</tr>
<tr class="even">
<td>180</td>
<td>0.274100</td>
</tr>
<tr class="odd">
<td>190</td>
<td>0.239300</td>
</tr>
<tr class="even">
<td>200</td>
<td>0.196200</td>
</tr>
<tr class="odd">
<td>210</td>
<td>0.129000</td>
</tr>
<tr class="even">
<td>220</td>
<td>0.110300</td>
</tr>
<tr class="odd">
<td>230</td>
<td>0.128900</td>
</tr>
<tr class="even">
<td>240</td>
<td>0.106200</td>
</tr>
<tr class="odd">
<td>250</td>
<td>0.096200</td>
</tr>
<tr class="even">
<td>260</td>
<td>0.061300</td>
</tr>
<tr class="odd">
<td>270</td>
<td>0.039100</td>
</tr>
<tr class="even">
<td>280</td>
<td>0.047200</td>
</tr>
<tr class="odd">
<td>290</td>
<td>0.078800</td>
</tr>
<tr class="even">
<td>300</td>
<td>0.054300</td>
</tr>
<tr class="odd">
<td>310</td>
<td>0.037800</td>
</tr>
<tr class="even">
<td>320</td>
<td>0.077300</td>
</tr>
<tr class="odd">
<td>330</td>
<td>0.055600</td>
</tr>
<tr class="even">
<td>340</td>
<td>0.028400</td>
</tr>
<tr class="odd">
<td>350</td>
<td>0.038200</td>
</tr>
<tr class="even">
<td>360</td>
<td>0.054800</td>
</tr>
<tr class="odd">
<td>370</td>
<td>0.079900</td>
</tr>
<tr class="even">
<td>380</td>
<td>0.002300</td>
</tr>
<tr class="odd">
<td>390</td>
<td>0.049900</td>
</tr>
<tr class="even">
<td>400</td>
<td>0.046200</td>
</tr>
</tbody>
</table>
<p>
</p></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>TrainOutput(global_step=400, training_loss=0.2804846516996622, metrics={'train_runtime': 67.5767, 'train_samples_per_second': 94.707, 'train_steps_per_second': 5.919, 'total_flos': 847791351398400.0, 'train_loss': 0.2804846516996622, 'epoch': 8.0})</code></pre>
</div>
</div>
<div id="d93d51bb-2154-43fc-8b0f-6c19657959db" class="cell" data-executioninfo="{&quot;elapsed&quot;:611,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389522883,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="ed62cdda-6f02-4a97-ad3c-9204245a094f" data-execution_count="63">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Trainer.train()에 의한 파인튜팅 이후 세 입력 문장 극성 판별</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>input_tokens <span class="op">=</span> tokenizer([<span class="st">"I feel fantastic"</span>, <span class="st">"My life is going something wrong"</span>, <span class="st">"I have not figured out what the chosen title has to do with the movie."</span>], truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3"></a>outputs <span class="op">=</span> model(torch.tensor(input_tokens[<span class="st">'input_ids'</span>]).to(device))</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co"># 영어 원문의 1과 0값과 달리 일반적인 용례에 따라 변경</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>label_dict <span class="op">=</span> {<span class="dv">1</span>:<span class="st">'positive'</span>, <span class="dv">0</span>:<span class="st">'negative'</span>}</span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="bu">print</span>([label_dict[i] <span class="cf">for</span> i <span class="kw">in</span> torch.argmax(outputs[<span class="st">'logits'</span>], axis<span class="op">=</span><span class="dv">1</span>).cpu().numpy()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['positive', 'negative', 'negative']</code></pre>
</div>
</div>
<div id="edcbf279-729b-4efa-9594-d483d4fd596a" class="cell" data-executioninfo="{&quot;elapsed&quot;:15174,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389548967,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="af2871ff-2481-45ee-c6ea-a12a04a3a27d" data-execution_count="64">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># 문제14에서 언급한 Trainer.train( ) 방식의 성과지표로서의 정확도를 여기서 구함</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co"># 모델 14의 주 10번 참조</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co"># 모델을 eval 모드로 전환</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>model.<span class="bu">eval</span>()</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co"># 문제 14 코딩의 변수 l과 혼동을 피하기 위해 컨테이너 리스트 l2 생성</span></span>
<span id="cb28-7"><a href="#cb28-7"></a>l2 <span class="op">=</span> []</span>
<span id="cb28-8"><a href="#cb28-8"></a></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co"># 반복 루프</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="cf">for</span> test_text <span class="kw">in</span> test_texts:</span>
<span id="cb28-11"><a href="#cb28-11"></a></span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="co"># 토크나이징을 통한 인코딩</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  input_tokens <span class="op">=</span> tokenizer([test_text], truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-14"><a href="#cb28-14"></a></span>
<span id="cb28-15"><a href="#cb28-15"></a>  <span class="co"># 모델을 사용한 추론</span></span>
<span id="cb28-16"><a href="#cb28-16"></a>  outputs <span class="op">=</span> model(torch.tensor(input_tokens[<span class="st">'input_ids'</span>]).to(device))</span>
<span id="cb28-17"><a href="#cb28-17"></a></span>
<span id="cb28-18"><a href="#cb28-18"></a>  <span class="co"># outputs에 담긴 logits값을 기준으로 행 단위로, 즉 입력 문장 단위로 가장 큰 logits값의 인덱스를 출력 후</span></span>
<span id="cb28-19"><a href="#cb28-19"></a>  <span class="co"># item( )을 사용하여 결과물 텐서를 CPU로 전송</span></span>
<span id="cb28-20"><a href="#cb28-20"></a>  <span class="co"># 이렇게 처리된 값을 입력문장별로 append( )를 통해 컨테이너 리스트 l에 하나씩 저장</span></span>
<span id="cb28-21"><a href="#cb28-21"></a>  l2.append(torch.argmax(outputs[<span class="st">'logits'</span>], axis<span class="op">=</span><span class="dv">1</span>).item())</span>
<span id="cb28-22"><a href="#cb28-22"></a></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="co"># 변수 correct_cnt 초기값을 0으로 설정</span></span>
<span id="cb28-24"><a href="#cb28-24"></a>correct_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb28-25"><a href="#cb28-25"></a></span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="co"># 리스트 l과 test_labels를 zip( )을 통해 쌍(pair)으로 묶은 후 각기 pred와 ans라는 변수로 추출</span></span>
<span id="cb28-27"><a href="#cb28-27"></a><span class="co"># zip()안의 데이터 쌍이 소진될 때까지 if문을 반복하여 계속 실행</span></span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="cf">for</span> pred, ans <span class="kw">in</span> <span class="bu">zip</span>(l2, test_labels):</span>
<span id="cb28-29"><a href="#cb28-29"></a>  <span class="cf">if</span> pred <span class="op">==</span> ans:</span>
<span id="cb28-30"><a href="#cb28-30"></a>    correct_cnt <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-31"><a href="#cb28-31"></a></span>
<span id="cb28-32"><a href="#cb28-32"></a><span class="co"># 정확도(accuracy) 계산</span></span>
<span id="cb28-33"><a href="#cb28-33"></a><span class="co"># 딥러닝 모델의 특성상 실행시마다 성과지표가 약간 다르게 산출될 수 있음</span></span>
<span id="cb28-34"><a href="#cb28-34"></a><span class="co"># correct_cnt는 pred와 ans가 일치하는 건수의 총합</span></span>
<span id="cb28-35"><a href="#cb28-35"></a><span class="co"># test_labels는 레이블 개수의 총합, 즉 입력 문장 전체 건수</span></span>
<span id="cb28-36"><a href="#cb28-36"></a><span class="bu">print</span>(correct_cnt<span class="op">/</span><span class="bu">len</span>(test_labels))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.876</code></pre>
</div>
</div>
<div id="5b574a86-e4bd-46e4-9f88-5174ace01925" class="cell" data-executioninfo="{&quot;elapsed&quot;:631,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389604568,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-execution_count="65">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># test_inference 함수 생성</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">def</span> test_inference(model, tokenizer):</span>
<span id="cb30-3"><a href="#cb30-3"></a>  input_tokens <span class="op">=</span> tokenizer([<span class="st">"I feel fantastic"</span>, <span class="st">"My life is going something wrong"</span>, <span class="st">"I have not figured out what the chosen title has to do with the movie."</span>], truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-4"><a href="#cb30-4"></a>  outputs <span class="op">=</span> model(torch.tensor(input_tokens[<span class="st">'input_ids'</span>]).to(device))</span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="co"># 영어 원문의 1과 0값 배정고 달리 일반적인 용례에 따라 변경</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  label_dict <span class="op">=</span> {<span class="dv">1</span>:<span class="st">'positive'</span>, <span class="dv">0</span>:<span class="st">'negative'</span>}</span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="cf">return</span> [label_dict[i] <span class="cf">for</span> i <span class="kw">in</span> torch.argmax(outputs[<span class="st">'logits'</span>], axis<span class="op">=</span><span class="dv">1</span>).cpu().numpy()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="43fdcc91-6e48-45c7-b22c-dbfe05acafd7" class="cell" data-executioninfo="{&quot;elapsed&quot;:216561,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389889012,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="42fd7631-a0c7-4f20-b891-b210ccc821cc" data-execution_count="66">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># 런타임 5분 30초 소요</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="im">from</span> transformers <span class="im">import</span> DistilBertForSequenceClassification, AdamW</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="im">from</span> transformers <span class="im">import</span> DistilBertTokenizerFast</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co">#１） 사전학습 모델과 토크나이저 불러오기</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="co">#    그리고 모델 실행결과에 to(devic) 코드 추가(가능한 경우 결과를 GPU에 전달)</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>tokenizer <span class="op">=</span> DistilBertTokenizerFast.from_pretrained(<span class="st">'distilbert-base-uncased'</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a>model <span class="op">=</span> DistilBertForSequenceClassification.from_pretrained(<span class="st">'distilbert-base-uncased'</span>)</span>
<span id="cb31-10"><a href="#cb31-10"></a>model.to(device)</span>
<span id="cb31-11"><a href="#cb31-11"></a></span>
<span id="cb31-12"><a href="#cb31-12"></a><span class="co"># 파인튜닝 이전 모델을 사용하여 test_inference 함수 실행</span></span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="bu">print</span>(test_inference(model, tokenizer))</span>
<span id="cb31-14"><a href="#cb31-14"></a></span>
<span id="cb31-15"><a href="#cb31-15"></a><span class="co">#２）DataLoader 인스턴스화</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>train_loader <span class="op">=</span> DataLoader(train_dataset, batch_size<span class="op">=</span><span class="dv">16</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co">#３）최적화 함수 정의</span></span>
<span id="cb31-19"><a href="#cb31-19"></a>optim <span class="op">=</span> AdamW(model.parameters(), lr<span class="op">=</span><span class="fl">5e-5</span>)</span>
<span id="cb31-20"><a href="#cb31-20"></a></span>
<span id="cb31-21"><a href="#cb31-21"></a><span class="co">#４）모델을 학습(train) 모드로 전환</span></span>
<span id="cb31-22"><a href="#cb31-22"></a><span class="co">#   이는 드롭아웃 및 배치 정규화에 영향을 미침</span></span>
<span id="cb31-23"><a href="#cb31-23"></a>model.train()</span>
<span id="cb31-24"><a href="#cb31-24"></a></span>
<span id="cb31-25"><a href="#cb31-25"></a>losses <span class="op">=</span> []</span>
<span id="cb31-26"><a href="#cb31-26"></a></span>
<span id="cb31-27"><a href="#cb31-27"></a><span class="co">#５）에포크 횟수(epochs)만큼 루프 반복</span></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span>):</span>
<span id="cb31-29"><a href="#cb31-29"></a>    <span class="bu">print</span>(<span class="ss">f'epoch:</span><span class="sc">{</span>epoch<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb31-30"><a href="#cb31-30"></a>    <span class="cf">for</span> batch <span class="kw">in</span> train_loader:</span>
<span id="cb31-31"><a href="#cb31-31"></a>        <span class="co">#６）최적화 함수의 기울기(그래디언트) 초기화</span></span>
<span id="cb31-32"><a href="#cb31-32"></a>        optim.zero_grad()</span>
<span id="cb31-33"><a href="#cb31-33"></a></span>
<span id="cb31-34"><a href="#cb31-34"></a>        input_ids <span class="op">=</span> batch[<span class="st">'input_ids'</span>].to(device)</span>
<span id="cb31-35"><a href="#cb31-35"></a>        attention_mask <span class="op">=</span> batch[<span class="st">'attention_mask'</span>].to(device)</span>
<span id="cb31-36"><a href="#cb31-36"></a>        labels <span class="op">=</span> batch[<span class="st">'labels'</span>].to(device)</span>
<span id="cb31-37"><a href="#cb31-37"></a></span>
<span id="cb31-38"><a href="#cb31-38"></a>        <span class="co">#７） 모델을 사용한 추론</span></span>
<span id="cb31-39"><a href="#cb31-39"></a>        outputs <span class="op">=</span> model(input_ids, attention_mask<span class="op">=</span>attention_mask, labels<span class="op">=</span>labels)</span>
<span id="cb31-40"><a href="#cb31-40"></a>        <span class="co">#８） 손실 계산</span></span>
<span id="cb31-41"><a href="#cb31-41"></a>        loss <span class="op">=</span> outputs[<span class="dv">0</span>]</span>
<span id="cb31-42"><a href="#cb31-42"></a>        losses.append(loss)</span>
<span id="cb31-43"><a href="#cb31-43"></a>        <span class="co">#９） 오차역전파</span></span>
<span id="cb31-44"><a href="#cb31-44"></a>        loss.backward()</span>
<span id="cb31-45"><a href="#cb31-45"></a>        <span class="co">#１０） 가중치(weight) 업데이트</span></span>
<span id="cb31-46"><a href="#cb31-46"></a>        optim.step()</span>
<span id="cb31-47"><a href="#cb31-47"></a></span>
<span id="cb31-48"><a href="#cb31-48"></a><span class="co"># 모델을 eval 모드로 전환</span></span>
<span id="cb31-49"><a href="#cb31-49"></a>model.<span class="bu">eval</span>()</span>
<span id="cb31-50"><a href="#cb31-50"></a></span>
<span id="cb31-51"><a href="#cb31-51"></a><span class="co"># eval 모드를 사용하여 test_inference 함수 실행</span></span>
<span id="cb31-52"><a href="#cb31-52"></a><span class="bu">print</span>(test_inference(model, tokenizer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/huggingface_hub-0.23.4-py3.8.egg/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
Some weights of DistilBertForSequenceClassification were not initialized from the model checkpoint at distilbert-base-uncased and are newly initialized: ['classifier.bias', 'classifier.weight', 'pre_classifier.bias', 'pre_classifier.weight']
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
/home/cgb3/anaconda3/envs/hf/lib/python3.12/site-packages/transformers/optimization.py:429: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>['positive', 'positive', 'positive']
epoch:0
epoch:1
epoch:2
epoch:3
epoch:4
epoch:5
epoch:6
epoch:7
['positive', 'negative', 'positive']</code></pre>
</div>
</div>
<div id="2a2c7c3c-6679-4725-8abb-a2ece19d148b" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">#!pip install matplotlib </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="62a3d2aa-7dd0-4ed8-a905-76cce2784ea6" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># # 다음은 에러가 발생하는 코드임에 주의</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># # 이를 수정하기 위해 몇 개의 코드를 아래에 추가함</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># plt.plot(losses)</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0010e9f8-7dc5-4497-af3a-61daf6ee06e6" class="cell" data-executioninfo="{&quot;elapsed&quot;:603,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389897919,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="1023a01e-5303-4e7f-92b9-925913e3ca66" data-execution_count="72">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="bu">print</span>(losses)</span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="bu">type</span>(losses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[tensor(0.6896, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6743, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7232, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6435, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7984, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6705, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6234, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6944, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7191, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6739, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7049, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6988, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7530, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7171, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7093, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6743, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6722, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6731, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7356, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6585, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6631, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7116, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6489, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6506, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7083, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6266, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6215, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6960, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6292, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6693, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6402, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6602, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5751, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5358, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4233, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6038, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5805, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3850, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.8131, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7712, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6551, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4271, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.7719, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4006, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6403, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4579, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4386, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4667, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5521, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3832, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4393, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3554, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3718, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4614, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2476, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6242, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1273, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5165, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2004, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4752, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3656, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4640, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4683, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3872, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4142, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2101, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5672, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4148, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1734, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4432, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2488, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3803, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3149, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1794, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2735, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0692, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3279, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1845, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3726, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3069, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1920, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1308, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3700, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2905, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0512, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6158, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.6974, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2247, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5211, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2256, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4478, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1355, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3630, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3645, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3055, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4659, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4414, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1772, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3226, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2523, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1157, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1749, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2590, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1810, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2662, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0996, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0781, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0702, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1421, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2621, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0540, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4938, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0223, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4348, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2020, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3059, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3600, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5890, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0956, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1898, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3317, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0464, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0484, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1058, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2110, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1650, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2112, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1265, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0779, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0337, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1637, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0918, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0792, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2498, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0320, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0851, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0525, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1685, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3785, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0310, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3235, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2505, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0266, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0241, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2853, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0272, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0671, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0804, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0193, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0169, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0187, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0189, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0142, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0247, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0182, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0197, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0195, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3021, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0127, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0120, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0138, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0197, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0144, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0118, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0147, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0116, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0330, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0110, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0109, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0551, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0129, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0084, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0087, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0327, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0107, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3017, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0077, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0102, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0153, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0061, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0068, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0602, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0184, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1096, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0077, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0234, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0614, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0088, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0062, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0093, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0046, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0051, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0074, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0071, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0748, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0459, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0118, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0317, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0043, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0039, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0052, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0857, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0062, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0319, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0239, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0214, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0169, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3571, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0122, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0051, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0139, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0052, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0450, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0440, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0040, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0042, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0070, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0046, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2946, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0084, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0049, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1915, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0058, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0543, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0081, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2727, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1148, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0230, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0076, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0091, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0163, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0057, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0069, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1706, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0776, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0049, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2013, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0066, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3029, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0188, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0133, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0129, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0048, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3768, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0176, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3615, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0443, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0930, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0140, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0102, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3686, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2168, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1502, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1344, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0095, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0184, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0508, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0684, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0242, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0179, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2457, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0197, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2134, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1785, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1717, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0122, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0061, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0069, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0154, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0177, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2219, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0781, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3202, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0336, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0572, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1933, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0327, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1650, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0187, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0869, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.5422, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0425, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1761, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1175, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0292, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0318, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0488, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1653, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.4091, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0559, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0492, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3804, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0155, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0196, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0324, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0145, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0170, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0785, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0306, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0064, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0313, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0636, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1193, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0345, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3166, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0057, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0035, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0037, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0040, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0185, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0040, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0362, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0042, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0039, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0050, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0031, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0035, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0040, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0039, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0027, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0046, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0060, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0107, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0038, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0041, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0048, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0180, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0037, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0032, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0027, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0029, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0026, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0017, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0634, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0526, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0028, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0019, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0027, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0029, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0051, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0024, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0057, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0021, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0027, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0030, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0026, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0025, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0029, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0017, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0025, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0025, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0326, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0830, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3151, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0020, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0037, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0025, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0038, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0032, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0064, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0232, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.2721, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.3031, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0030, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0043, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0057, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0031, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0166, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0026, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0160, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0027, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0026, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1102, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0556, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1896, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0050, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0043, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0040, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0687, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0251, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0102, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0049, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0020, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0082, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0607, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0052, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0579, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0022, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0044, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0063, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.1434, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0181, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0042, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0025, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;), tensor(0.0032, device='cuda:0', grad_fn=&lt;NllLossBackward0&gt;)]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>list</code></pre>
</div>
</div>
<div id="a58d8378-68f0-4d90-a1c5-7ea7a57850a6" class="cell" data-executioninfo="{&quot;elapsed&quot;:1529,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389902262,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="ace6957d-7fed-4bea-f496-69be0bd833b7" data-execution_count="73">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># 파이토치에서 item( )은 텐서에서 값을 파이썬 숫자로 추출하여 CPU로 전달</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>new_losses <span class="op">=</span> [i.item() <span class="cf">for</span> i <span class="kw">in</span> losses]</span>
<span id="cb39-3"><a href="#cb39-3"></a></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co"># 처음 5개 값 출력</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>new_losses[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>[0.6896294951438904,
 0.6742584705352783,
 0.7231898307800293,
 0.6434592604637146,
 0.7984352707862854]</code></pre>
</div>
</div>
<div id="c6f62ea7-5273-4619-bb1d-673561ba18e5" class="cell" data-executioninfo="{&quot;elapsed&quot;:571,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389906431,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="f1673a13-c41b-44ce-d665-b9c90f9f40bd" data-execution_count="74">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># 마지막 5개 값 출력</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>new_losses[<span class="op">-</span><span class="dv">5</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>[0.14343078434467316,
 0.01811479963362217,
 0.004169727675616741,
 0.002496510511264205,
 0.0032098903320729733]</code></pre>
</div>
</div>
<div id="869ef3b5-9fd5-4994-9399-bc7dc0e73137" class="cell" data-executioninfo="{&quot;elapsed&quot;:851,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389911224,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="d4c0ac01-9dae-4f64-8a26-cc65b35c2c3e" data-execution_count="75">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># matplotlib 라이브러리의 pyplot 모듈을 약칭 plt로 import</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb43-3"><a href="#cb43-3"></a>plt.plot(new_losses)</span>
<span id="cb43-4"><a href="#cb43-4"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture2_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2861e0a9-701b-4e90-9b73-4baeeaace695" class="cell" data-executioninfo="{&quot;elapsed&quot;:27143,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1688389943284,&quot;user&quot;:{&quot;displayName&quot;:&quot;Jason Book Yim&quot;,&quot;userId&quot;:&quot;02824935638305274154&quot;},&quot;user_tz&quot;:-540}" data-outputid="51815371-6a77-476b-d818-b0a66d55c2e2" data-execution_count="76">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># 모델을 eval 모드로 전환</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>model.<span class="bu">eval</span>()</span>
<span id="cb44-3"><a href="#cb44-3"></a></span>
<span id="cb44-4"><a href="#cb44-4"></a><span class="co"># 변수 l이라는 컨테이너 리스트 생성</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>l <span class="op">=</span> []</span>
<span id="cb44-6"><a href="#cb44-6"></a></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="co"># 반복 루프</span></span>
<span id="cb44-8"><a href="#cb44-8"></a><span class="cf">for</span> test_text <span class="kw">in</span> test_texts:</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a>  <span class="co"># 토크나이징을 통한 인코딩</span></span>
<span id="cb44-11"><a href="#cb44-11"></a>  input_tokens <span class="op">=</span> tokenizer([test_text], truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-12"><a href="#cb44-12"></a></span>
<span id="cb44-13"><a href="#cb44-13"></a>  <span class="co"># 모델을 사용한 추론</span></span>
<span id="cb44-14"><a href="#cb44-14"></a>  outputs <span class="op">=</span> model(torch.tensor(input_tokens[<span class="st">'input_ids'</span>]).to(device))</span>
<span id="cb44-15"><a href="#cb44-15"></a></span>
<span id="cb44-16"><a href="#cb44-16"></a>  <span class="co"># outputs에 담긴 logits값을 기준으로 행 단위로, 즉 입력 문장 단위로 가장 큰 logits값의 인덱스를 출력 후</span></span>
<span id="cb44-17"><a href="#cb44-17"></a>  <span class="co"># item( )을 사용하여 결과물 텐서 값을 추출하고 CPU로 전송</span></span>
<span id="cb44-18"><a href="#cb44-18"></a>  <span class="co"># 이렇게 처리된 값을 입력문장별로 append( )를 통해 컨테이너 리스트 l에 하나씩 저장</span></span>
<span id="cb44-19"><a href="#cb44-19"></a>  l.append(torch.argmax(outputs[<span class="st">'logits'</span>], axis<span class="op">=</span><span class="dv">1</span>).item())</span>
<span id="cb44-20"><a href="#cb44-20"></a></span>
<span id="cb44-21"><a href="#cb44-21"></a><span class="co"># 변수 correct_cnt 초기값을 0으로 설정</span></span>
<span id="cb44-22"><a href="#cb44-22"></a>correct_cnt <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-23"><a href="#cb44-23"></a></span>
<span id="cb44-24"><a href="#cb44-24"></a><span class="co"># 리스트 l과 test_labels를 zip( )을 통해 쌍(pair)으로 묶은 후 각기 pred와 ans라는 변수로 추출</span></span>
<span id="cb44-25"><a href="#cb44-25"></a><span class="co"># zip()안의 데이터 쌍이 소진될 때까지 if문을 반복하여 계속 실행</span></span>
<span id="cb44-26"><a href="#cb44-26"></a><span class="cf">for</span> pred, ans <span class="kw">in</span> <span class="bu">zip</span>(l, test_labels):</span>
<span id="cb44-27"><a href="#cb44-27"></a>  <span class="cf">if</span> pred <span class="op">==</span> ans:</span>
<span id="cb44-28"><a href="#cb44-28"></a>    <span class="co"># if 조건문이 참인 경우 correct_cnt값을 1씩 증가</span></span>
<span id="cb44-29"><a href="#cb44-29"></a>    correct_cnt <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb44-30"><a href="#cb44-30"></a></span>
<span id="cb44-31"><a href="#cb44-31"></a><span class="co"># 정확도(accuracy) 계산</span></span>
<span id="cb44-32"><a href="#cb44-32"></a><span class="co"># correct_cnt는 pred와 ans가 일치하는 건수의 총합</span></span>
<span id="cb44-33"><a href="#cb44-33"></a><span class="co"># len(test_labels)는 레이블 개수의 총합, 즉 입력 문장 전체 건수</span></span>
<span id="cb44-34"><a href="#cb44-34"></a><span class="bu">print</span>(correct_cnt<span class="op">/</span><span class="bu">len</span>(test_labels))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.864</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="miruetoto/yechan3" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>